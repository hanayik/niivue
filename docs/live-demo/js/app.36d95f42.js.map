{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?f1c0","webpack:///./src/components/controls.vue?4d15","webpack:///src/components/controls.vue","webpack:///./src/components/controls.vue?c575","webpack:///./src/components/controls.vue?1824","webpack:///./src/components/glviewer.vue?76f7","webpack:///src/components/glviewer.vue","webpack:///./src/components/glviewer.vue?6836","webpack:///./src/components/glviewer.vue?6c54","webpack:///src/App.vue","webpack:///./src/App.vue?1160","webpack:///./src/App.vue","webpack:///./src/plugins/vuetify.js","webpack:///./src/main.js","webpack:///./src/webgl-util/shader.js","webpack:///./src/components/glviewer.vue?bee5","webpack:///./src/shader-srcs.js","webpack:///./src/niivue.js","webpack:///./src/components/controls.vue?eb3a","webpack:///./src/bus.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","_v","staticStyle","overlayList","staticClass","on","$event","setSliceType","viewShown2D","viewShown3D","onSliceSlider2D","model","callback","$$v","sliceScrollVal","expression","_e","onClipPlaneChange","clipValX","clipValY","clipValZ","clipValW","onResetClipPlane","_s","coordinateString","staticRenderFns","onAddOverlay","overlays","_l","overlay","stopPropagation","toggleEye","eyeIcon","colorMaps","onColorChange","selectedColorMap","intensityMax","intensityMin","scopedSlots","_u","fn","intensityRange","$set","proxy","onOpacityChange","opacity","props","Array","components","draggable","colorSelected","overlays_","methods","bus","alert","component","VBtn","VCol","VExpansionPanel","VExpansionPanelContent","VExpansionPanelHeader","VExpansionPanels","VIcon","VRangeSlider","VRow","VSelect","VSlider","VSpacer","VTextField","dialog","onCrosshairColorChange","crosshairColor","discoMode","shader","String","created","selectedOverlay","last2DSliceVal","mouseDown","touchDown","zDown","discoModeColorMapTimer","discoModeCrosshairTimer","scale","watch","deep","handler","onWindowResize","bottomStatusBarHeight","canvas","document","querySelector","viewer","width","height","clientHeight","getBoundingClientRect","bottom","documentElement","style","floatColor","mounted","glEl","classList","add","id","clientWidth","appendChild","gc","set","gl","addEventListener","e","preventDefault","rect","deltaY","clearInterval","enable","CULL_FACE","cullFace","FRONT","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","VCard","VColorPicker","VDialog","controls","glviewer","tab","appTabs","sliceType","VApp","VAppBar","VFooter","VMain","VToolbar","Vue","use","Vuetify","config","productionTip","vuetify","render","h","App","$mount","Shader","vertexSrc","fragmentSrc","self","program","compileShader","regexUniform","matchUniformName","uniforms","vertexUnifs","match","fragUnifs","unif","forEach","getUniformLocation","useProgram","vert","frag","vs","createShader","VERTEX_SHADER","shaderSource","getShaderParameter","COMPILE_STATUS","console","log","getShaderInfoLog","fs","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","vertRenderShader","fragRenderShader","vertSliceShader","fragSliceShader","fragLineShader","vertColorbarShader","fragColorbarShader","vertLineShader","vertFontShader","fragFontShader","textHeight","colorbarHeight","crosshairWidth","backColor","sliceTypeAxial","sliceTypeCoronal","sliceTypeSagittal","sliceTypeMultiplanar","sliceTypeRender","renderAzimuth","renderElevation","crosshairPos","clipPlane","isRadiologicalConvention","volScaleMultiplier","_overlayItem","colorBarMargin","colormapTexture","volumeTexture","overlayTexture","sliceShader","lineShader","renderShader","colorbarShader","fontShader","fontMets","mousePos","numScreenSlices","screenSlices","leftTopWidthHeight","axCorSag","sliceOpacity","arrayEquals","a","b","isArray","every","val","index","x","y","mouseMove","drawSlices","getGL","clipPlaneMove","newPlane","setCrosshairColor","color","sliceScroll2D","posChange","isDelta","idx","posNow","posFuture","st","setSliceOpacity","op","setScale","getContext","scaleTo8Bit","A","overlayItem","volume","mn","hdr","cal_min","mx","cal_max","vox","img8","Uint8ClampedArray","v","scl_slope","scl_inter","overlayRGBA","dims","imgRGBA","radius","Math","min","halfX","halfY","halfZ","z","dx","abs","dy","dz","dist","sqrt","calibrateIntensity","Infinity","isFinite","global_min","global_max","reorient","affine","absR","mat","fromValues","ixyz","perm","rotM","R","copy","flip","requiresRot","identity","residualR","invert","multiply","reorientVolume","img","imgRaw","datatypeCode","Uint8Array","Int16Array","Float32Array","Uint16Array","aperm","outdim","inRaw","inStep","outStep","outStart","zi","yi","xi","outpix","pixDims","loadVolume","url","volumeURL","req","XMLHttpRequest","open","responseType","onerror","onload","dataBuffer","response","nii","selectColormap","colorMap","updateGLVolume","send","$on","loadPng","pngName","pngImage","Image","pngTexture","createTexture","activeTexture","TEXTURE3","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","texImage2D","RGBA","UNSIGNED_BYTE","src","initText","fetchMetrics","fetch","json","metrics","xadv","uv_lbwh","lbwh","distanceRange","atlas","size","scaleW","scaleH","glyphs","glyph","unicode","advance","undefined","planeBounds","atlasBounds","left","top","w","right","init","uniform1i","cubeStrip","vao","createVertexArray","bindVertexArray","vbo","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","deleteTexture","TEXTURE0","TEXTURE_3D","TEXTURE_WRAP_R","pixelStorei","UNPACK_ALIGNMENT","texStorage3D","R8","texSubImage3D","RED","imgRGBA8","TEXTURE2","RGBA8","lutName","lut","makeLut","TEXTURE1","texStorage2D","texSubImage2D","Rs","Gs","Bs","As","Is","idxLo","idxHi","idxRng","k","f","sliceScale","longestAxis","max","volScale","map","mouseClick","ltwh","isMirror","fracX","fracY","drawColorbar","uniform4fv","uniform2fv","uniform4f","drawArrays","TRIANGLE_STRIP","textWidth","str","bytes","Buffer","drawChar","xy","char","drawText","uniform2f","screenPxRange","uniform1f","drawTextRight","drawTextBelow","draw2D","crossXYZ","isMirrorLR","disable","xleft","xtop","draw3D","viewport","clearColor","fDistance","translate","rad","PI","rotate","inv","rayDir4","transformMat4","rayDir","normalize","tiny","uniformMatrix4fv","uniform3fv","posString","toFixed","$emit","frac2mm","pos","dim","sf","sform","mul","shim","scaleSlice","scalePix","wPix","hPix","clear","COLOR_BUFFER_BIT","wX","wY","hY","hZ","margin","finish"],"mappings":"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","file":"js/app.36d95f42.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',[_c('v-app-bar',{attrs:{\"app\":\"\"}},[_c('h2',[_vm._v(\"Niivue\")]),_c('v-spacer')],1),_c('v-main',[_c('v-row',{staticStyle:{\"height\":\"100%\"}},[_c('v-col',{attrs:{\"sm\":\"12\",\"md\":\"12\",\"lg\":\"4\"}},[_c('controls',{attrs:{\"overlays\":_vm.overlayList}})],1),_c('v-col',{attrs:{\"sm\":\"12\",\"md\":\"12\",\"lg\":\"8\"}},[_c('v-toolbar',{staticClass:\"pa-0 ma-0\",attrs:{\"elevation\":\"0\"}},[_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(0)}}},[_vm._v(\"A\")]),_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(2)}}},[_vm._v(\"S\")]),_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(1)}}},[_vm._v(\"C\")]),_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(4)}}},[_vm._v(\"R\")]),_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(3)}}},[_vm._v(\"MP\")]),_c('v-spacer')],1),(_vm.viewShown2D == true || _vm.viewShown3D == true)?_c('v-expansion-panels',[_c('v-expansion-panel',[_c('v-expansion-panel-header',[_c('v-row',{staticClass:\"align-center\",attrs:{\"no-gutters\":\"\"}},[_vm._v(\" Controls \"),_c('v-icon',{staticClass:\"mx-2\"},[_vm._v(\" mdi-arrow-expand-vertical \")])],1)],1),_c('v-expansion-panel-content',[(_vm.viewShown2D == true)?_c('v-row',[_c('v-slider',{attrs:{\"step\":\"0.01\",\"max\":\"1\",\"min\":\"0\",\"thumb-label\":\"\",\"label\":\"slice\"},on:{\"input\":_vm.onSliceSlider2D},model:{value:(_vm.sliceScrollVal),callback:function ($$v) {_vm.sliceScrollVal=$$v},expression:\"sliceScrollVal\"}})],1):_vm._e(),(_vm.viewShown3D == true)?_c('v-row',[_c('v-slider',{attrs:{\"step\":\"0.005\",\"max\":\"1\",\"min\":\"-1\",\"thumb-label\":\"\",\"label\":\"clip x\"},on:{\"input\":_vm.onClipPlaneChange},model:{value:(_vm.clipValX),callback:function ($$v) {_vm.clipValX=$$v},expression:\"clipValX\"}})],1):_vm._e(),(_vm.viewShown3D == true)?_c('v-row',[_c('v-slider',{attrs:{\"step\":\"0.005\",\"max\":\"1\",\"min\":\"-1\",\"thumb-label\":\"\",\"label\":\"clip y\"},on:{\"input\":_vm.onClipPlaneChange},model:{value:(_vm.clipValY),callback:function ($$v) {_vm.clipValY=$$v},expression:\"clipValY\"}})],1):_vm._e(),(_vm.viewShown3D == true)?_c('v-row',[_c('v-slider',{attrs:{\"step\":\"0.005\",\"max\":\"1\",\"min\":\"-1\",\"thumb-label\":\"\",\"label\":\"clip z\"},on:{\"input\":_vm.onClipPlaneChange},model:{value:(_vm.clipValZ),callback:function ($$v) {_vm.clipValZ=$$v},expression:\"clipValZ\"}})],1):_vm._e(),(_vm.viewShown3D == true)?_c('v-row',[_c('v-slider',{attrs:{\"step\":\"0.005\",\"max\":\"0.5\",\"min\":\"-0.5\",\"thumb-label\":\"\",\"label\":\"clip w\"},on:{\"input\":_vm.onClipPlaneChange},model:{value:(_vm.clipValW),callback:function ($$v) {_vm.clipValW=$$v},expression:\"clipValW\"}})],1):_vm._e(),_c('v-row',[(_vm.viewShown3D)?_c('v-btn',{staticClass:\"mx-auto\",on:{\"click\":_vm.onResetClipPlane}},[_vm._v(\"reset\")]):_vm._e()],1)],1)],1)],1):_vm._e(),_c('glviewer',{attrs:{\"overlays\":_vm.overlayList}})],1)],1)],1),_c('v-footer',{attrs:{\"app\":\"\"}},[_c('v-row',[_c('v-col',{attrs:{\"align\":\"center\",\"justify\":\"center\"}},[_c('span',{staticClass:\"text-caption\"},[_vm._v(_vm._s(_vm.coordinateString))])])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"mt-5\",attrs:{\"id\":\"controls\"}},[_c('v-row',{staticClass:\"my-2 mx-2 align-center\"},[_c('h3',[_vm._v(\"Layers\")]),_c('v-spacer'),_c('v-btn',{staticClass:\"mx-2\",attrs:{\"small\":\"\"},on:{\"click\":_vm.onAddOverlay}},[_vm._v(\"Add overlay\")])],1),_c('v-row',{attrs:{\"no-gutters\":\"\"}},[_c('v-expansion-panels',[_c('draggable',{staticClass:\"row mx-2 my-2\",attrs:{\"handle\":\".drag-handle\"},model:{value:(_vm.overlays),callback:function ($$v) {_vm.overlays=$$v},expression:\"overlays\"}},_vm._l((_vm.overlays),function(overlay,i){return _c('v-expansion-panel',{key:i},[_c('v-expansion-panel-header',[_c('v-row',{staticClass:\"align-center\",attrs:{\"no-gutters\":\"\"}},[_c('v-icon',{staticClass:\"mx-2 drag-handle\"},[_vm._v(\" mdi-drag-horizontal-variant \")]),_c('v-icon',{staticClass:\"mx-2\",on:{\"click\":function($event){$event.stopPropagation();return _vm.toggleEye($event)}}},[_vm._v(\" \"+_vm._s(_vm.eyeIcon)+\" \")]),_vm._v(_vm._s(overlay.name)+\" \")],1)],1),_c('v-expansion-panel-content',[_c('v-row',[_c('v-select',{attrs:{\"items\":_vm.colorMaps,\"label\":\"Color map\"},on:{\"change\":_vm.onColorChange},model:{value:(_vm.selectedColorMap),callback:function ($$v) {_vm.selectedColorMap=$$v},expression:\"selectedColorMap\"}})],1),_c('v-row',[_c('v-col',{staticClass:\"px-4\"},[_c('p',[_vm._v(\"Intensity range\")]),_c('v-range-slider',{staticClass:\"align-center\",attrs:{\"max\":overlay.intensityMax,\"min\":overlay.intensityMin,\"hide-details\":\"\"},scopedSlots:_vm._u([{key:\"prepend\",fn:function(){return [_c('v-text-field',{staticClass:\"mt-0 pt-0\",staticStyle:{\"width\":\"60px\"},attrs:{\"value\":overlay.intensityRange[0],\"hide-details\":\"\",\"single-line\":\"\",\"type\":\"number\"},on:{\"input\":function($event){return _vm.$set(overlay.intensityRange, 0, $event)}}})]},proxy:true},{key:\"append\",fn:function(){return [_c('v-text-field',{staticClass:\"mt-0 pt-0\",staticStyle:{\"width\":\"60px\"},attrs:{\"value\":overlay.intensityRange[1],\"hide-details\":\"\",\"single-line\":\"\",\"type\":\"number\"},on:{\"input\":function($event){return _vm.$set(overlay.intensityRange, 1, $event)}}})]},proxy:true}],null,true),model:{value:(overlay.intensityRange),callback:function ($$v) {_vm.$set(overlay, \"intensityRange\", $$v)},expression:\"overlay.intensityRange\"}})],1)],1),_c('v-row',[_c('v-col',[_c('p',[_vm._v(\"Opacity\")]),_c('v-slider',{attrs:{\"step\":\"0.01\",\"max\":\"1\",\"min\":\"0\",\"thumb-label\":\"\",\"ticks\":\"\"},on:{\"input\":_vm.onOpacityChange},model:{value:(_vm.opacity),callback:function ($$v) {_vm.opacity=$$v},expression:\"opacity\"}})],1)],1)],1)],1)}),1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n\n  <div class='mt-5' id=\"controls\" >\n    <v-row class=\"my-2 mx-2 align-center\">\n      <h3>Layers</h3>\n      <v-spacer></v-spacer>\n      <v-btn @click='onAddOverlay' class=\"mx-2\" small>Add overlay</v-btn>\n    </v-row>\n    <v-row no-gutters>\n      <v-expansion-panels>\n        <draggable handle='.drag-handle' class=\"row mx-2 my-2\" v-model=\"overlays\">\n          <v-expansion-panel\n          v-for=\"(overlay, i) in overlays\"\n          :key=\"i\">\n          <v-expansion-panel-header>\n            <v-row no-gutters class=\"align-center\">\n              <v-icon class=\"mx-2 drag-handle\"> mdi-drag-horizontal-variant </v-icon>\n              <v-icon class=\"mx-2\" @click.stop=\"toggleEye\"> {{ eyeIcon }} </v-icon>{{ overlay.name }}\n            </v-row>\n            \n          </v-expansion-panel-header>\n          <v-expansion-panel-content>\n            <v-row>\n              <v-select\n                :items=\"colorMaps\"\n                v-model=\"selectedColorMap\"\n                @change=\"onColorChange\"\n                label=\"Color map\">\n              </v-select>\n            </v-row>\n            <v-row>\n             <v-col class=\"px-4\">\n              <p>Intensity range</p>\n              <v-range-slider\n                v-model=\"overlay.intensityRange\"\n                :max=\"overlay.intensityMax\"\n                :min=\"overlay.intensityMin\"\n                hide-details\n                class=\"align-center\"\n\n              >\n                <template v-slot:prepend>\n                  <v-text-field\n                    :value=\"overlay.intensityRange[0]\"\n                    class=\"mt-0 pt-0\"\n                    hide-details\n                    single-line\n                    type=\"number\"\n                    style=\"width: 60px\"\n                    @input=\"$set(overlay.intensityRange, 0, $event)\"\n                  ></v-text-field>\n                </template>\n                <template v-slot:append>\n                  <v-text-field\n                    :value=\"overlay.intensityRange[1]\"\n                    class=\"mt-0 pt-0\"\n                    hide-details\n                    single-line\n                    type=\"number\"\n                    style=\"width: 60px\"\n                    @input=\"$set(overlay.intensityRange, 1, $event)\"\n                  ></v-text-field>\n                </template>\n              </v-range-slider>\n            </v-col> \n            </v-row>\n\n            <v-row>\n              <v-col>\n              <p>Opacity</p>\n                <v-slider\n                  v-model=\"opacity\"\n                  step=\"0.01\"\n                  max=\"1\"\n                  min=\"0\"\n                  thumb-label\n                  ticks\n                  @input=\"onOpacityChange\"\n                >\n                </v-slider>\n              </v-col>\n            </v-row>\n          </v-expansion-panel-content>\n        </v-expansion-panel>\n        </draggable>\n      </v-expansion-panels>\n    </v-row>\n\n    \n  </div>\n\n</template>\n\n<script>\nimport draggable from \"vuedraggable\";\nimport {bus} from \"@/bus.js\"\n\nexport default {\n  props: {\n    overlays: Array,\n  },\n\n  name: 'controls',\n\n  components: {\n    draggable\n  },\n\n  data (){\n    return {\n      colorSelected: 'gray',\n      colorMaps:['gray', 'Winter', 'Warm', 'Plasma', 'Viridis', 'Inferno'],\n      selectedColorMap: 'gray',\n      eyeIcon: \"mdi-eye\",\n      overlays_: this.overlays,\n      draggable: true,\n      opacity: 1.0,\n      \n    }\n  },\n\n  methods: {\n    toggleEye: function() {\n      this.eyeIcon = this.eyeIcon == \"mdi-eye\" ? \"mdi-eye-off\" : \"mdi-eye\"\n    },\n\n    onColorChange: function() {\n      bus.$emit('colormap-change', this.selectedColorMap);\n\n    },\n\n    onOpacityChange: function() {\n      bus.$emit('opacity-change', this.opacity);\n\n    },\n\n    onAddOverlay: function () {\n      alert('adding overlays in this demo is not implemented yet! :)')\n    }\n  }\n\n};\n\n</script>\n\n<style scoped>\n\ndrag-handle {\n  color: black;\n}\n\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./controls.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./controls.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./controls.vue?vue&type=template&id=4b65bab5&scoped=true&\"\nimport script from \"./controls.vue?vue&type=script&lang=js&\"\nexport * from \"./controls.vue?vue&type=script&lang=js&\"\nimport style0 from \"./controls.vue?vue&type=style&index=0&id=4b65bab5&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4b65bab5\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VExpansionPanel } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelContent } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelHeader } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanels } from 'vuetify/lib/components/VExpansionPanel';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRangeSlider } from 'vuetify/lib/components/VRangeSlider';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\nimport { VSlider } from 'vuetify/lib/components/VSlider';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VBtn,VCol,VExpansionPanel,VExpansionPanelContent,VExpansionPanelHeader,VExpansionPanels,VIcon,VRangeSlider,VRow,VSelect,VSlider,VSpacer,VTextField})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"viewer\",attrs:{\"id\":\"viewer\"}},[_c('v-dialog',{attrs:{\"max-width\":\"400\"},model:{value:(_vm.dialog),callback:function ($$v) {_vm.dialog=$$v},expression:\"dialog\"}},[_c('v-color-picker',{attrs:{\"width\":\"400\",\"mode\":\"rgba\"},on:{\"input\":_vm.onCrosshairColorChange},model:{value:(_vm.crosshairColor),callback:function ($$v) {_vm.crosshairColor=$$v},expression:\"crosshairColor\"}})],1),_c('v-dialog',{attrs:{\"max-width\":\"400\"},model:{value:(_vm.discoMode),callback:function ($$v) {_vm.discoMode=$$v},expression:\"discoMode\"}},[_c('v-card',{attrs:{\"color\":\"rgba(0, 0, 0, 0.4)\"}},[_c('v-row',{attrs:{\"no-gutters\":\"\"}},[_c('v-spacer'),_c('h2',{staticStyle:{\"color\":\"white\"}},[_vm._v(\"Disco mode\")]),_c('v-spacer')],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"viewer\" id=\"viewer\" >\n    <v-dialog\n      v-model=\"dialog\"\n      max-width=\"400\">\n      <v-color-picker width=400 mode='rgba' v-model=\"crosshairColor\" @input=\"onCrosshairColorChange\">\n      </v-color-picker>\n    </v-dialog>\n\n    <v-dialog\n      v-model=\"discoMode\"\n      max-width=\"400\">\n      <v-card color=\"rgba(0, 0, 0, 0.4)\">\n        <v-row no-gutters>  \n          <v-spacer></v-spacer>\n          <h2 style=\"color: white;\">Disco mode</h2>\n          <v-spacer></v-spacer>\n        </v-row>\n      </v-card>\n    </v-dialog>\n  </div>\n</template>\n<script>\nimport * as Hammer from 'hammerjs';\nimport * as nv from \"../niivue.js\";\nimport {bus} from \"@/bus.js\"\n\nexport default {\n  name: \"glviewer\",\n  /*\n  props are passed to the nii-vue component from it's parent\n  they can be used. Similar to passing variables to a function\n  */\n  props: {\n    overlays: Array,\n    shader: String,\n  },\n  created () {\n    bus.$on('slice-type-change', function (sliceType) {\n      nv.setSliceType(sliceType)\n    });\n\n    bus.$on('set-2D-slice', function (slicePosVal) {\n      nv.sliceScroll2D(slicePosVal, null, null, false) // x,y = null\n    });\n\n    bus.$on('set-clip-planes', function (newPlanes) {\n      nv.clipPlaneMove(newPlanes)\n    });\n\n\n\n  },\n  \n  data() {\n    return {\n      selectedOverlay: 0,\n      last2DSliceVal: 0.5,\n      mouseDown: false,\n      touchDown: false,\n      zDown: false,\n      discoMode: false,\n      discoModeColorMapTimer: null,\n      discoModeCrosshairTimer: null,\n      scale: 1,\n      dialog: false,\n      crosshairColor: { r: 255, g: 0, b: 0, a: 1 },\n      colorMaps:['Winter', 'Warm', 'Plasma', 'Viridis', 'Inferno'],\n      selectedColorMap: 'Winter',\n\n    };\n  },\n  watch: {\n    // watch for changes to hdr property of volume object\n    // this detects changes from hdr=null to hdr=real_data\n    overlays: {\n      deep: true,\n      handler () {\n        //nv.selectColormap(this.gl, this.overlays[this.selectedOverlay].colorMap)\n        //nv.updateGLVolume(this.gl, this.overlays[this.selectedOverlay])\n    },\n\n    }\n    \n      },\n  methods: {\n    onWindowResize: function() {\n      var bottomStatusBarHeight = 100 // this is an estimate\n      var canvas = document.querySelector(\"#gl\") \n      var viewer = document.querySelector(\"#viewer\")\n      canvas.width =  viewer.clientWidth\n      canvas.height = viewer.clientHeight\n      // there has to be a better way to handle this resizing. It seems odd to need the document (window) client\n      // height for this to work. \n      if (viewer.getBoundingClientRect().bottom > document.documentElement.clientHeight){\n        viewer.style.height = document.documentElement.clientHeight - bottomStatusBarHeight\n        canvas.height = document.documentElement.clientHeight - bottomStatusBarHeight\n      }\n      nv.drawSlices(this.gl, this.overlays[this.selectedOverlay])\n    },\n\n    onCrosshairColorChange: function() {\n      var floatColor = [this.crosshairColor.r/255, this.crosshairColor.g/255, this.crosshairColor.b/255, this.crosshairColor.a]\n      nv.setCrosshairColor(floatColor)\n    }\n\n  },\n  mounted() {\n    // get the gl context after the component has been mounted and initialized\n    const glEl = document.createElement('canvas')\n    glEl.classList.add('fillParent')\n    const viewer = document.querySelector(\"#viewer\")\n    glEl.id = \"gl\"\n    glEl.width = viewer.clientWidth//viewer.offsetWidth-1\n    glEl.height = viewer.clientHeight//viewer.offsetHeight-1\n    viewer.appendChild(glEl)\n    const canvas = document.querySelector(\"#gl\");\n    const gl = canvas.getContext(\"webgl2\");\n\n    var gc = new Hammer(canvas); // gesture controller\n    gc.get('press').set({ time: 2000 });\n    gc.get('pinch').set({ enable: true });\n\n    gl.canvas.addEventListener('mousedown', (e) => {\n      e.preventDefault()\n      this.dialog = false\n      this.mouseDown = true\n      var rect = canvas.getBoundingClientRect()\n      nv.mouseClick(this.gl, this.overlays[0], e.clientX - rect.left, e.clientY - rect.top)\n      nv.mouseDown(e.clientX - rect.left,e.clientY - rect.top)\n    })\n    \n    gl.canvas.addEventListener('touchstart', (e) => {\n      e.preventDefault()\n      this.dialog = false\n      this.touchDown = true\n      var rect = canvas.getBoundingClientRect()\n      nv.mouseClick(this.gl, this.overlays[0], e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top)\n      nv.mouseDown(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top)\n    })\n\n    \n    gl.canvas.addEventListener('mousemove', (e) => {\n      if (this.mouseDown) {\n        var rect = canvas.getBoundingClientRect()\n        // mouseClick if any 2D mode\n        nv.mouseClick(this.gl, this.overlays[0], e.clientX - rect.left, e.clientY - rect.top)\n        // mouseMove if 3D render mode\n        nv.mouseMove(e.clientX - rect.left,e.clientY - rect.top)\n      }\n    })\n\n    gl.canvas.addEventListener('touchmove', (e) => {\n      if (this.touchDown && e.touches.length < 2) {\n        var rect = canvas.getBoundingClientRect()\n        nv.mouseClick(this.gl, this.overlays[0], e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top)\n        nv.mouseMove(e.touches[0].clientX - rect.left,e.touches[0].clientY - rect.top)\n      }\n    })\n\n\n    gc.on('pinchin', () => {\n      // scroll 2D slices \n      nv.sliceScroll2D(0.001, null, null)\n    })\n\n    gc.on('pinchout', () => {\n      // scroll 2D slices \n      nv.sliceScroll2D(-0.001, null, null)\n    })\n\n    gl.canvas.addEventListener('wheel', (e) => {\n      if (this.zDown) {\n        e.preventDefault()\n        this.scale += e.deltaY * -0.01\n        nv.setScale(this.scale)\n      } else {\n        // scroll 2D slices \n        e.preventDefault()\n        e.stopPropagation()\n        var rect = canvas.getBoundingClientRect()\n        if (e.deltaY < 0){\n          nv.sliceScroll2D(-0.01, e.clientX - rect.left, e.clientY - rect.top)\n        } else {\n          nv.sliceScroll2D(0.01, e.clientX - rect.left, e.clientY - rect.top)\n        }\n        \n      }\n    })\n\n    gc.on('press', () => {\n      this.dialog = true\n    })\n\n    gl.canvas.addEventListener('mouseup', () => {\n      this.mouseDown = false\n    })\n\n    gl.canvas.addEventListener('tocuhend', () => {\n      this.touchDown = false\n    })\n\n\n    window.addEventListener('keypress', (e) => {\n      if (e.key === 'z') {\n        this.zDown = true\n      }\n      if (e.key === 'd') {\n        this.discoMode = this.discoMode == false ? true: false\n        clearInterval(this.discoModeColorMapTimer)\n        clearInterval(this.discoModeCrosshairTimer)\n        if (this.discoMode) {\n          this.discoModeColorMapTimer = setInterval(\n            () => {\n              bus.$emit('colormap-change', this.colorMaps[Math.floor(Math.random() * this.colorMaps.length)]);\n\n            }, 200)\n          this.discoModeCrosshairTimer = setInterval(\n            function () {\n              nv.setCrosshairColor([Math.random(), Math.random(), Math.random(), 1])\n            }, 200)\n        } else {\n          bus.$emit('colormap-change', \"gray\");\n          nv.setCrosshairColor([1, 0, 0, 1])\n\n        }\n      }\n\n    })\n\n    window.addEventListener('keyup', (e) => {\n      if (e.key === 'z') {\n        this.zDown = false\n      }\n    })\n\n    window.addEventListener('resize', this.onWindowResize)\n    this.gl = gl;\n    this.gl.enable(this.gl.CULL_FACE);\n    this.gl.cullFace(this.gl.FRONT);\n    this.gl.enable(this.gl.BLEND);\n    this.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\n    nv.init(this.gl);\n    //this.overlays.forEach((overlay, i) =>  nv.loadVolume(overlay, i))\n    nv.loadVolume(this.overlays[this.selectedOverlay]); // just load first overlay. addtional overlays are not handled yet\n    \n    bus.$on('opacity-change', (opacity) => {\n      nv.setSliceOpacity(opacity)\n    });\n\n  },\n};\n\n</script>\n\n<style scoped>\n.viewer {\n  background-color: black;\n  width: 100%;\n  height:100%;\n  line-height:0;\n}\n\n.fillParent {\n  height: 100%;\n  width: 100%;\n}\n\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./glviewer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./glviewer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./glviewer.vue?vue&type=template&id=5ce1200a&scoped=true&\"\nimport script from \"./glviewer.vue?vue&type=script&lang=js&\"\nexport * from \"./glviewer.vue?vue&type=script&lang=js&\"\nimport style0 from \"./glviewer.vue?vue&type=style&index=0&id=5ce1200a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5ce1200a\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VColorPicker } from 'vuetify/lib/components/VColorPicker';\nimport { VDialog } from 'vuetify/lib/components/VDialog';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VCard,VColorPicker,VDialog,VRow,VSpacer})\n","<template>\n  <v-app>\n    <v-app-bar app>\n      <!-- make app bar scroll in horizontal direction -->\n      <!--\n      <v-tabs v-model='tab'>\n        <v-tabs-slider color='black'></v-tabs-slider>\n        <v-tab\n          v-for='item in appTabs'\n          :key='item'>\n          {{ item }}\n        </v-tab>\n      </v-tabs>\n      -->\n      <h2>Niivue</h2>\n      <v-spacer>\n      </v-spacer>\n    </v-app-bar>\n\n    <v-main>\n      <v-row style=\"height:100%\">\n      <!-- app uses a 12 column layout, so the controls take up 4 columns on the left of the screen -->\n      <v-col sm=12 md=12 lg=4>\n        <controls :overlays=\"overlayList\">\n        </controls>\n      </v-col>\n\n      <v-col sm=12 md=12 lg=8>\n        <v-toolbar elevation=0 class=\"pa-0 ma-0\">\n          <v-btn @click='setSliceType(0)'>A</v-btn>\n          <v-btn @click='setSliceType(2)'>S</v-btn>\n          <v-btn @click='setSliceType(1)'>C</v-btn>\n          <v-btn @click='setSliceType(4)'>R</v-btn>\n          <v-btn @click='setSliceType(3)'>MP</v-btn>\n          <v-spacer></v-spacer>\n        </v-toolbar>\n      <v-expansion-panels v-if=\"viewShown2D == true || viewShown3D == true\">\n          <v-expansion-panel>\n          <v-expansion-panel-header>\n            <v-row no-gutters class=\"align-center\">\n              Controls\n              <v-icon class=\"mx-2\"> mdi-arrow-expand-vertical </v-icon>\n            </v-row>\n          </v-expansion-panel-header>\n          <v-expansion-panel-content>\n            <v-row v-if=\"viewShown2D == true\">\n            <v-slider\n              v-model=\"sliceScrollVal\"\n              step=\"0.01\"\n              max=\"1\"\n              min=\"0\"\n              thumb-label\n              @input=\"onSliceSlider2D\"\n              label=\"slice\"\n            >\n            </v-slider>\n          </v-row>\n          <v-row v-if=\"viewShown3D == true\">\n            <v-slider\n                v-model=\"clipValX\"\n                step=\"0.005\"\n                max=\"1\"\n                min=\"-1\"\n                thumb-label\n                @input=\"onClipPlaneChange\"\n                label=\"clip x\"\n              >\n            </v-slider>\n          </v-row>\n          <v-row v-if=\"viewShown3D == true\">\n            <v-slider\n                v-model=\"clipValY\"\n                step=\"0.005\"\n                max=\"1\"\n                min=\"-1\"\n                thumb-label\n                @input=\"onClipPlaneChange\"\n                label=\"clip y\"\n              >\n            </v-slider>\n          </v-row>\n          <v-row v-if=\"viewShown3D == true\">\n            <v-slider\n                v-model=\"clipValZ\"\n                step=\"0.005\"\n                max=\"1\"\n                min=\"-1\"\n                thumb-label\n                @input=\"onClipPlaneChange\"\n                label=\"clip z\"\n              >\n            </v-slider>\n          </v-row>\n          <v-row v-if=\"viewShown3D == true\">\n            <v-slider\n                v-model=\"clipValW\"\n                step=\"0.005\"\n                max=\"0.5\"\n                min=\"-0.5\"\n                thumb-label\n                @input=\"onClipPlaneChange\"\n                label=\"clip w\"\n              >\n            </v-slider>\n          </v-row>\n          <v-row>\n            <v-btn v-if=\"viewShown3D\" @click=\"onResetClipPlane\" class='mx-auto'>reset</v-btn>\n          </v-row>\n          </v-expansion-panel-content>\n        </v-expansion-panel>\n      </v-expansion-panels>\n\n        <glviewer :overlays=\"overlayList\"></glviewer>\n      </v-col>\n    </v-row>\n    </v-main>\n    <v-footer app>\n      <v-row >\n        <v-col align=\"center\" justify=\"center\" >\n          <span class='text-caption'>{{ coordinateString }}</span> \n        </v-col>\n      </v-row>\n    </v-footer>\n  </v-app>\n</template>\n\n<script>\nimport controls from './components/controls.vue'\nimport glviewer from './components/glviewer.vue'\nimport {bus} from \"@/bus.js\"\n\nexport default {\n  name: 'App',\n\n  components: {\n    controls,\n    glviewer\n  },\n\n  created () {\n    bus.$on('crosshair-pos-change', (posString) => {\n    this.coordinateString = posString \n    });\n\n  },\n  data (){\n    return {\n      tab: null,\n      viewShown2D: false,\n      viewShown3D: false,\n      clipValX: 0,\n      clipValY: 0,\n      clipValZ: 0,\n      clipValW: 0,\n      sliceScrollVal: 0.5,\n      appTabs: ['Menu', 'Draw', 'Edit', 'Scripting'],\n      coordinateString: '0x0x0',\n      overlayList: [\n        {\n          volumeURL: \"./spm152.nii.gz\",\n          volume: {hdr: null, img: null},\n          name: \"standard\",\n          intensityMin: 0,\n          intensityMax: 100,\n          intensityRange:[0, 100],\n          colorMap: \"gray\", // gray\n          opacity: 100,\n        },\n        {\n          volumeURL: \"./motor.nii.gz\",\n          volume: {hdr: null, img: null},\n          name: \"motor\",\n          intensityMin: 0,\n          intensityMax: 100,\n          intensityRange:[0, 100],\n          colorMap: \"Warm\", // gray\n          opacity: 100,\n        },\n\n      ]\n    }\n  },\n\n  methods: {\n    setSliceType: function(sliceType) {\n      if (sliceType < 3 ){\n        this.viewShown2D = true\n        this.viewShown3D = false\n      } else if (sliceType == 4) {\n        this.viewShown2D = false\n        this.viewShown3D = true\n      } else {\n        this.viewShown2D = false\n        this.viewShown3D = false\n      }\n      bus.$emit('slice-type-change', sliceType);\n    },\n\n    onSliceSlider2D: function() {\n      if (this.viewShown2D){\n        bus.$emit('set-2D-slice', this.sliceScrollVal);\n      }           \n    },\n\n    onClipPlaneChange: function() {\n      if (this.viewShown3D){\n        bus.$emit('set-clip-planes', [this.clipValX, this.clipValY, this.clipValZ, this.clipValW]);\n\n      }           \n    },\n\n    onResetClipPlane: function() {\n      if (this.viewShown3D){\n        this.clipValX = 0\n        this.clipValY = 0\n        this.clipValZ = 0\n        this.clipValW = 0\n        bus.$emit('set-clip-planes', [this.clipValX, this.clipValY, this.clipValZ, this.clipValW]);\n\n      }           \n    }\n\n\n  },\n};\n</script>\n\n<style>\n\n\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=53f5f2b4&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\nimport { VAppBar } from 'vuetify/lib/components/VAppBar';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VExpansionPanel } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelContent } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelHeader } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanels } from 'vuetify/lib/components/VExpansionPanel';\nimport { VFooter } from 'vuetify/lib/components/VFooter';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VMain } from 'vuetify/lib/components/VMain';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSlider } from 'vuetify/lib/components/VSlider';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VToolbar } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VApp,VAppBar,VBtn,VCol,VExpansionPanel,VExpansionPanelContent,VExpansionPanelHeader,VExpansionPanels,VFooter,VIcon,VMain,VRow,VSlider,VSpacer,VToolbar})\n","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib/framework';\nimport 'vuetify/dist/vuetify.min.css'\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","import Vue from 'vue'\nimport App from './App.vue'\nimport vuetify from './plugins/vuetify';\n\n\nVue.config.productionTip = false\n\nnew Vue({\n  vuetify,\n  render: h => h(App)\n}).$mount('#app')\n","export var Shader = function(gl, vertexSrc, fragmentSrc) {\n    var self = this;\n    this.program = compileShader(gl, vertexSrc, fragmentSrc);\n\n    var regexUniform = /uniform[^;]+[ ](\\w+);/g\n    var matchUniformName = /uniform[^;]+[ ](\\w+);/\n\n    this.uniforms = {};\n\n    var vertexUnifs = vertexSrc.match(regexUniform);\n    var fragUnifs = fragmentSrc.match(regexUniform);\n\n    if (vertexUnifs) {\n        vertexUnifs.forEach(function(unif) {\n            var m = unif.match(matchUniformName);\n            self.uniforms[m[1]] = -1;\n        });\n    }\n    if (fragUnifs) {\n        fragUnifs.forEach(function(unif) {\n            var m = unif.match(matchUniformName);\n            self.uniforms[m[1]] = -1;\n        });\n    }\n\n    for (var unif in this.uniforms) {\n        this.uniforms[unif] = gl.getUniformLocation(this.program, unif);\n    }\n}\n\nShader.prototype.use = function(gl) {\n    gl.useProgram(this.program);\n}\n\n// Compile and link the shaders vert and frag. vert and frag should contain\n// the shader source code for the vertex and fragment shaders respectively\n// Returns the compiled and linked program, or null if compilation or linking failed\nexport var compileShader = function(gl, vert, frag){\n    var vs = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vs, vert);\n    gl.compileShader(vs);\n    if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)){\n        alert(\"Vertex shader failed to compile, see console for log\");\n        console.log(gl.getShaderInfoLog(vs));\n        return null;\n    }\n\n    var fs = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fs, frag);\n    gl.compileShader(fs);\n    if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)){\n        alert(\"Fragment shader failed to compile, see console for log\");\n        console.log(gl.getShaderInfoLog(fs));\n        return null;\n    }\n\n    var program = gl.createProgram();\n    gl.attachShader(program, vs);\n    gl.attachShader(program, fs);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)){\n        alert(\"Shader failed to link, see console for log\");\n        console.log(gl.getProgramInfoLog(program));\n        return null;\n    }\n    return program;\n}\n\nexport var getGLExtension = function(gl, ext) {\n    if (!gl.getExtension(ext)) {\n        alert(\"Missing \" + ext + \" WebGL extension\");\n        return false;\n    }\n    return true;\n}\n\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./glviewer.vue?vue&type=style&index=0&id=5ce1200a&scoped=true&lang=css&\"","export var vertRenderShader =\n`#version 300 es\n#line 4\nlayout(location=0) in vec3 pos;\nuniform mat4 mvpMtx;\nout vec3 vColor;\nvoid main(void) {\n\tgl_Position = mvpMtx * vec4(2.0 * (pos.xyz - 0.5), 1.0);\n\tvColor = pos;\n}`;\n\nexport var fragRenderShader =\n`#version 300 es\n#line 15\nprecision highp int;\nprecision highp float;\nuniform vec3 rayDir;\nuniform vec3 texVox;\nuniform vec4 clipPlane;\nuniform highp sampler3D volume, overlay;\nuniform highp sampler2D colormap;\nuniform float overlays;\nin vec3 vColor;\nout vec4 fColor;\nvec3 GetBackPosition (vec3 startPosition) {\n vec3 invR = 1.0 / rayDir;\n vec3 tbot = invR * (vec3(0.0)-startPosition);\n vec3 ttop = invR * (vec3(1.0)-startPosition);\n vec3 tmax = max(ttop, tbot);\n vec2 t = min(tmax.xx, tmax.yz);\n return startPosition + (rayDir * min(t.x, t.y));\n}\nvec4 applyClip (vec3 dir, inout vec4 samplePos, inout float len) {\n\tfloat cdot = dot(dir,clipPlane.xyz);\n\tif  ((clipPlane.a > 1.0) || (cdot == 0.0)) return samplePos;\n    bool frontface = (cdot > 0.0);\n\tfloat clipThick = 2.0;\n    float dis = (-clipPlane.a - dot(clipPlane.xyz, samplePos.xyz-0.5)) / cdot;\n    float  disBackFace = (-(clipPlane.a-clipThick) - dot(clipPlane.xyz, samplePos.xyz-0.5)) / cdot;\n    if (((frontface) && (dis >= len)) || ((!frontface) && (dis <= 0.0))) {\n        samplePos.a = len + 1.0;\n        return samplePos;\n    }\n    if (frontface) {\n        dis = max(0.0, dis);\n        samplePos = vec4(samplePos.xyz+dir * dis, dis);\n        len = min(disBackFace, len);\n    }\n    if (!frontface) {\n        len = min(dis, len);\n        disBackFace = max(0.0, disBackFace);\n        samplePos = vec4(samplePos.xyz+dir * disBackFace, disBackFace);\n    }\n    return samplePos;\n}\nvoid main() {\n    fColor = vec4(0.0,0.0,0.0,0.0);\n\tvec3 start = vColor;\n\t//fColor = vec4(start, 1.0); return;\n\tvec3 backPosition = GetBackPosition(start);\n\t//fColor = vec4(backPosition, 1.0); return;\n    vec3 dir = backPosition - start;\n    float len = length(dir);\n\tfloat lenVox = length((texVox * start) - (texVox * backPosition));\n\tfloat sliceSize = len / lenVox; //e.g. if ray length is 1.0 and traverses 50 voxels, each voxel is 0.02 in unit cube\n\tfloat stepSize = sliceSize; //quality: larger step is faster traversal, but fewer samples\n\tfloat opacityCorrection = stepSize/sliceSize;\n    dir = normalize(dir);\n\tvec4 deltaDir = vec4(dir.xyz * stepSize, stepSize);\n\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\tfloat lenNoClip = len;\n\tvec4 clipPos = applyClip(dir, samplePos, len);\n\t//start: OPTIONAL fast pass: rapid traversal until first hit\n\tfloat stepSizeFast = sliceSize * 1.9;\n\tvec4 deltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(volume, samplePos.xyz).r;\n\t\tif (val > 0.01) break;\n\t\tsamplePos += deltaDirFast; //advance ray position\n\t}\n\tif ((samplePos.a > len) && (overlays < 1.0)) return;\n\tsamplePos -= deltaDirFast;\n\tif (samplePos.a < 0.0)\n\t\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//end: fast pass\n\tvec4 colAcc = vec4(0.0,0.0,0.0,0.0);\n\tconst float earlyTermination = 0.95;\n\tfloat backNearest = len; //assume no hit\n    float ran = fract(sin(gl_FragCoord.x * 12.9898 + gl_FragCoord.y * 78.233) * 43758.5453);\n    samplePos += deltaDir * ran; //jitter ray\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(volume, samplePos.xyz).r;\n\t\tsamplePos += deltaDir; //advance ray position\n\t\tif (val < 0.01) continue;\n\t\tbackNearest = min(backNearest, samplePos.a); \n\t\tvec4 colorSample = texture(colormap, vec2(val, 0.5)).rgba;\n\t\tcolorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);\n\t\tcolorSample.rgb *= colorSample.a;\n\t\tcolAcc= (1.0 - colAcc.a) * colorSample + colAcc;\n\t\tif ( colAcc.a > earlyTermination )\n\t\t\tbreak;\n\t}\n\tcolAcc.a = colAcc.a / earlyTermination;\n\tfColor = colAcc;\n\tif (overlays < 1.0) return;\n\t//overlay pass\n\tlen = lenNoClip;\n\tsamplePos = vec4(start.xyz, 0.0); //ray position\n    //start: OPTIONAL fast pass: rapid traversal until first hit\n\tstepSizeFast = sliceSize * 1.9;\n\tdeltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(overlay, samplePos.xyz).a;\n\t\tif (val > 0.01) break;\n\t\tsamplePos += deltaDirFast; //advance ray position\n\t}\n\tif (samplePos.a > len) return;\n\tsamplePos -= deltaDirFast;\n\tif (samplePos.a < 0.0)\n\t\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//end: fast pass\n\t\t\n\tfloat overFarthest = len;\n\tcolAcc = vec4(0.0, 0.0, 0.0, 0.0);\n\tsamplePos += deltaDir * ran; //jitter ray\n\twhile (samplePos.a <= len) {\n\t\tvec4 colorSample = texture(overlay, samplePos.xyz);\n\t\tsamplePos += deltaDir; //advance ray position\n\t\tif (colorSample.a < 0.01) continue;\n\t\tcolorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);\n\t\tcolorSample.rgb *= colorSample.a;\n\t\tcolAcc= (1.0 - colAcc.a) * colorSample + colAcc;\n\t\toverFarthest = samplePos.a;\n\t\tif ( colAcc.a > earlyTermination )\n\t\t\tbreak;\n\t}\n\tfloat overMix = colAcc.a;\n\tfloat overlayDepth = 0.3;\n\tif (fColor.a <= 0.0) \n\t\t\toverMix = 1.0;\n\telse if (((overFarthest) > backNearest)) {\n\t\tfloat dx = (overFarthest - backNearest)/1.73;\n\t\tdx = fColor.a * pow(dx, overlayDepth);\n\t\toverMix *= 1.0 - dx;\n\t}\n\tfColor.rgb = mix(fColor.rgb, colAcc.rgb, overMix);\n\tfColor.a = max(fColor.a, colAcc.a);\n}`;\n\nexport var vertSliceShader =\n`#version 300 es\n#line 81\nlayout(location=0) in vec3 pos;\nuniform int axCorSag;\nuniform float slice;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nout vec3 texPos;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tif (axCorSag == 1)\n\t\ttexPos = vec3(pos.x, slice, pos.y);\n\telse if (axCorSag == 2)\n\t\ttexPos = vec3(slice, pos.x, pos.y);\n\telse\n\t\ttexPos = vec3(pos.xy, slice);\n}`;\n\nexport var fragSliceShader =\n`#version 300 es\n#line 105\nprecision highp int;\nprecision highp float;\nuniform highp sampler3D volume, overlay;\nuniform highp sampler2D colormap;\nuniform float opacity;\nin vec3 texPos;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(colormap, vec2(texture(volume, texPos).r, 0.5)).rgb, opacity);\n\tvec4 ocolor = texture(overlay, texPos);\n\tcolor.rgb = mix(color.rgb, ocolor.rgb, ocolor.a);\n}`;\n\nexport var fragLineShader =\n`#version 300 es\n#line 119\nprecision highp int;\nprecision highp float;\nuniform vec4 lineColor;\nout vec4 color;\nvoid main() {\n\tcolor = lineColor;\n}`;\n\nexport var vertColorbarShader =\n`#version 300 es\n#line 130\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nout float vColor;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tvColor = pos.x;\n}`;\n\nexport var fragColorbarShader =\n`#version 300 es\n#line 147\nprecision highp int;\nprecision highp float;\nuniform highp sampler2D colormap;\nin float vColor;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(colormap, vec2(vColor, 0.5)).rgb, 1.0);\n}`;\n\nexport var vertLineShader =\n`#version 300 es\n#line 159\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n}`;\n\nexport var vertFontShader =\n`#version 300 es\n#line 174\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nuniform vec4 uvLeftTopWidthHeight;\nout vec2 vUV;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tvUV = vec2(uvLeftTopWidthHeight.x + (pos.x * uvLeftTopWidthHeight.z), uvLeftTopWidthHeight.y  + ((1.0 - pos.y) * uvLeftTopWidthHeight.w) );\n}`;\n\nexport var fragFontShader =\n`#version 300 es\n#line 192\nprecision highp int;\nprecision highp float;\nuniform highp sampler2D fontTexture;\nuniform vec4 fontColor;\nuniform float screenPxRange;\nin vec2 vUV;\nout vec4 color;\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\nvoid main() {\n\tvec3 msd = texture(fontTexture, vUV).rgb;\n\t//color = vec4(msd, 1.0); return;\n    float sd = median(msd.r, msd.g, msd.b);\n    float screenPxDistance = screenPxRange*(sd - 0.5);\n    float opacity = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n\tcolor = vec4(fontColor.rgb , fontColor.a * opacity);\n}`;\n","import * as nii from \"nifti-reader-js\"\nimport { Shader } from \"./webgl-util/shader.js\";\nimport * as mat from \"gl-matrix\";\nimport { vertSliceShader, fragSliceShader } from \"./shader-srcs.js\";\nimport { vertLineShader, fragLineShader } from \"./shader-srcs.js\";\nimport { vertRenderShader, fragRenderShader } from \"./shader-srcs.js\";\nimport { vertColorbarShader, fragColorbarShader } from \"./shader-srcs.js\";\nimport { vertFontShader, fragFontShader } from \"./shader-srcs.js\";\n\nimport {bus} from \"@/bus.js\"\n\nexport var textHeight = 0.03; //0 for no text, fraction of canvas height\nexport var colorbarHeight = 0.05; //0 for no colorbars, fraction of NIfTI j dimension\nexport var crosshairWidth = 1; //0 for no crosshairs, pixels\nexport var backColor =  [0, 0, 0, 1];\nexport const sliceTypeAxial = 0;\nexport const sliceTypeCoronal = 1;\nexport const sliceTypeSagittal = 2;\nexport const sliceTypeMultiplanar = 3;\nexport const sliceTypeRender = 4;\nexport var sliceType = sliceTypeMultiplanar; //view: axial, coronal, sagittal, multiplanar or render\nexport var renderAzimuth = 120;\nexport var renderElevation = 15;\nexport var crosshairPos = [0.5, 0.5, 0.5];\nexport var overlays = 1; //number of loaded overlays _DEMO_: 0\nexport var clipPlane = [0, 0, 0, 0]; //x,y,z and depth of clip plane _DEMO_: [0.5, 0.5, 0.0, 2.0]\nexport var isRadiologicalConvention = false;\n\nvar crosshairColor =  [1, 0, 0, 1];\nvar volScaleMultiplier = 1;\nvar _overlayItem = null\nvar colorBarMargin = 0.05\n\nvar colormapTexture = null\nvar volumeTexture = null\nvar overlayTexture = null\nvar sliceShader = null //program for 2D slice views\nvar lineShader = null //program for cross-hairs\nvar renderShader = null //program for 3D views\nvar colorbarShader = null //program for 3D views\nvar fontShader = null //program for displaying text\nvar fontMets = null //position/height/width of each character in font texture\nvar mousePos = [0,0];\nvar numScreenSlices = 0; //e.g. for multiplanar view, 3 simultaneous slices: axial, coronal, sagittal\nvar screenSlices = [ //location and type of each 2D slice on screen, allows clicking to detect position\n  {leftTopWidthHeight: [1, 0, 0, 1], axCorSag: sliceTypeAxial},\n  {leftTopWidthHeight: [1, 0, 0, 1], axCorSag: sliceTypeAxial},\n  {leftTopWidthHeight: [1, 0, 0, 1], axCorSag: sliceTypeAxial},\n  {leftTopWidthHeight: [1, 0, 0, 1], axCorSag: sliceTypeAxial}\n];\nvar sliceOpacity = 1.0\n\nbus.$on('colormap-change', function (selectedColorMap) {\n    selectColormap(getGL(), selectedColorMap)\n    drawSlices(getGL(), _overlayItem)\n});\n\nfunction arrayEquals(a, b) {\n  return Array.isArray(a) &&\n    Array.isArray(b) &&\n    a.length === b.length &&\n    a.every((val, index) => val === b[index]);\n}\n\nexport function mouseDown(x, y) {\n\tif (sliceType != sliceTypeRender) return;\n\tmousePos = [x,y];\n} // mouseDown()\n\nexport function mouseMove(x, y) {\n\tif (sliceType != sliceTypeRender) return;\n\trenderAzimuth += x - mousePos[0];\n\trenderElevation += y - mousePos[1];\n\tmousePos = [x,y];\n\tdrawSlices(getGL(), _overlayItem) //_overlayItem is local to niivue.js and is set in loadVolume()\n} // mouseMove()\n\nexport function clipPlaneMove(newPlane) {\n\tif (sliceType != sliceTypeRender) return;\n  clipPlane = newPlane\n\tdrawSlices(getGL(), _overlayItem) //_overlayItem is local to niivue.js and is set in loadVolume()\n} // clipPlaneMove\n\nexport function setCrosshairColor(color) {\n  crosshairColor = color\n  drawSlices(getGL(), _overlayItem) //_overlayItem is local to niivue.js and is set in loadVolume()\n} // setCrosshairColor()\n\nexport function sliceScroll2D(posChange, x, y, isDelta=true) {\n  if (sliceType === sliceTypeMultiplanar){\n    //mouseMPScroll(posChange, x, y) // not working when mouse over axial or Sag slices (works over Cor for some reason)\n    return\n  }\n  var idx\n  if (sliceType == sliceTypeAxial) idx = 2;\n  if (sliceType == sliceTypeSagittal) idx = 0;\n  if (sliceType == sliceTypeCoronal) idx = 1;\n  if (isDelta){\n    var posNow = crosshairPos[idx]\n    var posFuture = posNow + posChange\n    if (posFuture > 1) posFuture = 1;\n    if (posFuture < 0) posFuture = 0;\n    crosshairPos[idx] = posFuture\n  } else {\n    crosshairPos[idx] = posChange\n  }\n  drawSlices(getGL(), _overlayItem) //_overlayItem is local to niivue.js and is set in loadVolume()\n} // sliceScroll2D()\n\nexport function setSliceType(st) {\n  sliceType = st\n  drawSlices(getGL(), _overlayItem) //_overlayItem is local to niivue.js and is set in loadVolume()\n} // setSliceType()\n\nexport function setSliceOpacity(op) {\n  sliceOpacity = op\n  drawSlices(getGL(), _overlayItem) //_overlayItem is local to niivue.js and is set in loadVolume()\n} // setSliceOpacity()\n\nexport function setScale(scale) {\n  volScaleMultiplier = scale\n  drawSlices(getGL(), _overlayItem) //_overlayItem is local to niivue.js and is set in loadVolume()\n} // setScale()\n\nexport function getGL() {\n\tvar gl = document.querySelector(\"#gl\").getContext(\"webgl2\");\n\tif (!gl)\n\t\treturn null;\n\treturn gl;\n} // getGL()\n\nfunction scaleTo8Bit(A, overlayItem) {\n\tvar volume = overlayItem.volume\n\tvar mn = volume.hdr.cal_min;\n\tvar mx = volume.hdr.cal_max;\n\tvar vox = A.length\n\tvar img8 = new Uint8ClampedArray(vox);\n\tvar scale = 1;\n\tvar i\n\tif (mx > mn) scale = 255 / (mx - mn);\n\tfor (i = 0; i < (vox - 1); i++) {\n\t\tvar v = A[i];\n\t\tv = (v * volume.hdr.scl_slope) + volume.hdr.scl_inter;\n\t\timg8[i] = (v - mn) * scale;\n\t}\n\treturn img8 // return scaled\n} // scaleTo8Bit()\n\nfunction overlayRGBA(overlayItem) {\n\tlet hdr = overlayItem.volume.hdr;\n\tlet vox = hdr.dims[1] * hdr.dims[2] * hdr.dims[3];\n\tlet imgRGBA = new Uint8ClampedArray(vox * 4);\n\tlet radius = 0.2 * Math.min(Math.min(hdr.dims[1], hdr.dims[2]), hdr.dims[3]);\n\tlet halfX = 0.5 * hdr.dims[1];\n\tlet halfY = 0.5 * hdr.dims[2];\n\tlet halfZ = 0.5 * hdr.dims[3];\n\tlet j = 0;\n\tfor (let z = 0; z < hdr.dims[3]; z++) {\n\t\tfor (let y = 0; y < hdr.dims[2]; y++) {\n\t\t\tfor (let x = 0; x < hdr.dims[1]; x++) {\n\t\t\t\tlet dx = (Math.abs(x - halfX));\n\t\t\t\tlet dy = (Math.abs(y - halfY));\n\t\t\t\tlet dz = (Math.abs(z - halfZ));\n\t\t\t\tlet dist = Math.sqrt(dx*dx + dy*dy + dz * dz);\n\t\t\t\tlet v = 0;\n\t\t\t\tif (dist < radius) v = 255;\n\t\t\t\timgRGBA[j] = 0; //Red\n\t\t\t\tj++;\n\t\t\t\timgRGBA[j] = v; //Green\n\t\t\t\tj++;\n\t\t\t\timgRGBA[j] = 0; //Blue\n\t\t\t\tj++;\n\t\t\t\timgRGBA[j] = v * 0.5; //Alpha\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t}\n\treturn imgRGBA;\n} // overlayRGBA()\n\nexport function calibrateIntensity(A, overlayItem) {\n  var volume = overlayItem.volume\n  var vox = A.length;\n\tvar mn = Infinity;\n\tvar mx = -Infinity;\n\tvar i\n\tfor (i = 0; i < (vox - 1); i++) {\n\t\tif (!isFinite(A[i])) continue;\n\t\tif (A[i] < mn) mn = A[i];\n\t\tif (A[i] > mx) mx = A[i];\n\t}\n\t//calibrate intensity\n\tif ((isFinite(volume.hdr.scl_slope)) && (isFinite(volume.hdr.scl_inter)) && (volume.hdr.scl_slope !== 0.0)) {\n\t\t//console.log(\">> mn %f mx %f %f %f\", mn, mx, hdr.scl_slope, hdr.scl_inter);\n\t\tmn = (mn * volume.hdr.scl_slope) + volume.hdr.scl_inter;\n\t\tmx = (mx * volume.hdr.scl_slope) + volume.hdr.scl_inter;\n\t} else {\n\t\tvolume.hdr.scl_slope = 1.0;\n\t\tvolume.hdr.scl_inter = 0.0;\n\t}\n\t//console.log(\"vx %d type %d mn %f mx %f\", vox, hdr.datatypeCode, mn, mx);\n\t//console.log(\"cal mn..mx %f..%f\", hdr.cal_min, hdr.cal_max);\n\tvolume.hdr.global_min = mn;\n\tvolume.hdr.global_max = mx;\n\tif ((!isFinite(volume.hdr.cal_min)) || (!isFinite(volume.hdr.cal_max)) || (volume.hdr.cal_min >= volume.hdr.cal_max)) {\n\t\tvolume.hdr.cal_min = mn;\n\t\tvolume.hdr.cal_max = mx;\n\t}\n} // calibrateIntensity()\n\nfunction reorient(hdr) {\n// port of Matlab reorient() https://github.com/xiangruili/dicm2nii/blob/master/nii_viewer.m\n// not elegant, as JavaScript arrays are always 1D\n\tlet a = hdr.affine;\n\tlet absR = mat.mat3.fromValues(Math.abs(a[0][0]),Math.abs(a[0][1]),Math.abs(a[0][2]), Math.abs(a[1][0]),Math.abs(a[1][1]),Math.abs(a[1][2]), Math.abs(a[2][0]),Math.abs(a[2][1]),Math.abs(a[2][2]));\n\t//mat.mat3.transpose(A,A);\n\t//first column = x\n\tlet ixyz = [1, 1, 1];\n    if (absR[3] > absR[0]) ixyz[0] = 2;//(absR[1][0] > absR[0][0]) ixyz[0] = 2;\n    if ((absR[6] > absR[0]) && (absR[6]> absR[3])) ixyz[0] = 3;//((absR[2][0] > absR[0][0]) && (absR[2][0]> absR[1][0])) ixyz[0] = 3;\n    ixyz[1] = 1;\n    if (ixyz[0] === 1) {\n\t\tif (absR[4] > absR[7]) //(absR[1][1] > absR[2][1])\n\t\t\tixyz[1] = 2\n\t\telse\n\t\t\tixyz[1] = 3;\n\t} else if (ixyz[0] === 2) {\n       if  (absR[1] > absR[7])//(absR[0][1] > absR[2][1])\n          ixyz[1] = 1\n       else\n           ixyz[1] = 3;\n    } else {\n       if (absR[1] > absR[4])//(absR[0][1] > absR[1][1])\n          ixyz[1] = 1\n       else\n           ixyz[1] = 2;\n    }\n    //third column = z: constrained as x+y+z = 1+2+3 = 6\n    ixyz[2] = 6 - ixyz[1] - ixyz[0];\n\tlet perm = [1,2,3];\n    perm[ixyz[0]-1] = 1;\n    perm[ixyz[1]-1] = 2;\n    perm[ixyz[2]-1] = 3;\n\tlet rotM = mat.mat4.fromValues(a[0][0],a[0][1],a[0][2],a[0][3], a[1][0],a[1][1],a[1][2],a[1][3], a[2][0],a[2][1],a[2][2],a[2][3], 0,0,0,1);\n\tlet R = mat.mat4.create();\n\tmat.mat4.copy(R, rotM);\n\tfor (let i = 0; i < 3; i++)\n\t\tfor (let j = 0; j < 3; j++)\n\t\t\tR[(i*4)+j] =  rotM[(i*4)+perm[j]-1] ;//rotM[i+(4*(perm[j]-1))];//rotM[i],[perm[j]-1];\n\tlet flip = [0, 0, 0];\n    if (R[0] < 0) flip[0] = 1; //R[0][0]\n    if (R[5] < 0) flip[1] = 1; //R[1][1]\n    if (R[10] < 0) flip[2] = 1; //R[2][2]\n\tlet requiresRot = false;\n\tif (arrayEquals(perm, [1,2,3]) && arrayEquals(flip, [0,0,0]))\n\t\treturn {perm, R, requiresRot};\n\trequiresRot = true;\n\tmat.mat4.identity(rotM);\n    rotM[0+(0 * 4)] = 1-flip[0]*2;\n    rotM[1+(1 * 4)] = 1-flip[1]*2;\n    rotM[2+(2 * 4)] = 1-flip[2]*2;\n    rotM[3+(0*4)] = ((hdr.dims[perm[0]])-1) * flip[0];\n    rotM[3+(1*4)] = ((hdr.dims[perm[1]])-1) * flip[1];\n\trotM[3+(2*4)] = ((hdr.dims[perm[2]])-1) * flip[2];\n\tlet residualR = mat.mat4.create();\n\tmat.mat4.invert(residualR, rotM);\n\tmat.mat4.multiply(residualR, residualR, R);\n\tfor (let i = 0; i < 3; i++)\n\t\tif (flip[i] !== 0) perm[i] = -perm[i];\n    return {perm, residualR, requiresRot};\n} // reorient()\n\nfunction reorientVolume(hdr, img) {\n\t//rotate 3D volume to match approximately match RAS\n\t//lots of room for speed/memory opitmization, e.g. LAS -> RAS all in plane\n\tlet {perm, residualR, requiresRot} = reorient(hdr);\n\tif (!requiresRot) return; //already rotated\n\tconsole.log(\"FLIP!\");\n\tvar imgRaw = null\n\tif (hdr.datatypeCode === 2) //data already uint8\n\t\timgRaw = new Uint8Array(img);\n\telse if (hdr.datatypeCode === 4)\n\t\timgRaw = new Int16Array(img);\n\telse if (hdr.datatypeCode === 16)\n\t\timgRaw = new Float32Array(img);\n\telse if (hdr.datatypeCode === 512)\n\t\timgRaw = new Uint16Array(img);\n\tlet aperm = [Math.abs(perm[0]), Math.abs(perm[1]), Math.abs(perm[2])];\n\tlet outdim = [hdr.dims[aperm[0]], hdr.dims[aperm[1]], hdr.dims[aperm[2]] ];\n\tlet inRaw = [...imgRaw];\n\tlet inStep = [1, hdr.dims[1], hdr.dims[1] * hdr.dims[2]]; //increment i,j,k\n\tlet outStep = [inStep[aperm[0]-1], inStep[aperm[1]-1], inStep[aperm[2]-1] ];\n\tlet outStart = [0,0,0];\n\tfor (let p = 0; p < 3; p++) { //flip dimensions\n\t\tif (perm[p] < 0) {\n\t\t\toutStart[p] = (outStep[p] * (outdim[p] - 1));\n\t\t\toutStep[p] = -outStep[p];\n\t\t}\n\t}\n\tlet j = 0;\n\tfor (let z = 0; z < outdim[2]; z++) {\n\t\tlet zi = outStart[2] + (z * outStep[2]);\n\t\tfor (let y = 0; y < outdim[1]; y++) {\n\t\t\tlet yi = outStart[1] + (y * outStep[1]);\n\t\t\tfor (let x = 0; x < outdim[0]; x++) {\n\t\t\t\tlet xi = outStart[0] + (x * outStep[0]);\n\t\t\t\timgRaw[j] = inRaw[xi+yi+zi];\n\t\t\t\tj ++;\n\t\t\t} //for x\n\t\t} //for y\n\t} //for z\n\thdr.dims[1] = outdim[0];\n\thdr.dims[2] = outdim[1];\n\thdr.dims[3] = outdim[2];\n\tlet outpix = [hdr.pixDims[aperm[0]], hdr.pixDims[aperm[1]], hdr.pixDims[aperm[2]] ];\n\thdr.pixDims[1] = outpix[0];\n\thdr.pixDims[2] = outpix[1];\n\thdr.pixDims[3] = outpix[2];\n\thdr.affine[0] = [residualR[0], residualR[1], residualR[2], residualR[3] ];\n\thdr.affine[1] = [residualR[4], residualR[5], residualR[6], residualR[7] ];\n\thdr.affine[2] = [residualR[8], residualR[9], residualR[10], residualR[11] ];\n} // reorientVolume()\n\nexport function loadVolume(overlayItem) {\n\tvar hdr = null\n\tvar img = null\n\tvar url = overlayItem.volumeURL\n\tvar req = new XMLHttpRequest();\n\treq.open(\"GET\", url, true);\n\treq.responseType = \"arraybuffer\";\n\treq.onerror = function () {\n\t\tconsole.log = \"Error Loading Volume\";\n\t}\n\treq.onload = function () {\n\t\tvar dataBuffer = req.response;\n\t\tif (dataBuffer) {\n\t\t\thdr = nii.readHeader(dataBuffer);\n\t\t\tif (nii.isCompressed(dataBuffer)) {\n\t\t\t\timg = nii.readImage(hdr, nii.decompress(dataBuffer));\n\t\t\t} else {\n\t\t\t\timg = nii.readImage(hdr, dataBuffer);\n\t\t\t}\n\t\t\treorientVolume(hdr, img);\n\t\t} else {\n\t\t\talert(\"Unable to load buffer properly from volume?\");\n\t\t\tconsole.log(\"no buffer?\");\n\t\t}\n\t\toverlayItem.volume.hdr = hdr\n\t\toverlayItem.volume.img = img\n\t\t_overlayItem = overlayItem\n\t\tselectColormap(getGL(), overlayItem.colorMap)\n\t\tupdateGLVolume(getGL(), overlayItem)\n\t};\n\treq.send();\n\treturn\n} // loadVolume()\n\nvar loadPng = function(gl, pngName) {\n\tvar pngImage = null;\n\tpngImage = new Image();\n\tpngImage.onload = function() {\n\t\t//console.log(\"PNG resolution \", pngImage.width, \",\", pngImage.height);\n\t\tvar pngTexture = gl.createTexture();\n\t\tgl.activeTexture(gl.TEXTURE3);\n\t\tgl.bindTexture(gl.TEXTURE_2D, pngTexture);\n\t\t// Set the parameters so we can render any size image.\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t\t// Upload the image into the texture.\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, pngImage);\n\t}\n\tpngImage.src = pngName;  // MUST BE SAME DOMAIN!!!\n\t//console.log(\"loading PNG \", pngName);\n} // loadPng()\n\nasync function initText(gl) {\n\t//load bitmap\n\tawait loadPng(gl, 'fnt.png');\n\t//create font metrics\n\tfontMets = [];\n\tfor (let id = 0; id < 256; id++) { //clear ASCII codes 0..256\n\t\tfontMets[id] = {};\n\t\tfontMets[id].xadv = 0;\n\t\tfontMets[id].uv_lbwh = [0, 0, 0, 0];\n\t\tfontMets[id].lbwh = [0, 0, 0, 0];\n\t}\n\t//load metrics values: may only sparsely describe range 0..255\n\tvar metrics = [];\n\tasync function fetchMetrics() {\n\t\tconst response = await fetch('./fnt.json');\n\t\tmetrics = await response.json();\n\t}\n\tawait fetchMetrics();\n\tfontMets.distanceRange = metrics.atlas.distanceRange;\n\tfontMets.size = metrics.atlas.size;\n\tlet scaleW = metrics.atlas.width;\n\tlet scaleH = metrics.atlas.height;\n\tfor (let i = 0; i < metrics.glyphs.length; i++) {\n\t\tlet glyph = metrics.glyphs[i];\n\t\tlet id = glyph.unicode;\n\t\tfontMets[id].xadv = glyph.advance;\n\t\tif (glyph.planeBounds  === undefined) continue;\n\t\tlet l = glyph.atlasBounds.left / scaleW;\n\t\tlet b = ((scaleH - glyph.atlasBounds.top) / scaleH);\n\t\tlet w = (glyph.atlasBounds.right - glyph.atlasBounds.left) / scaleW;\n\t\tlet h = (glyph.atlasBounds.top - glyph.atlasBounds.bottom) / scaleH;\n\t\tfontMets[id].uv_lbwh = [l, b, w, h];\n\t\tl = glyph.planeBounds.left;\n\t\tb = glyph.planeBounds.bottom;\n\t\tw = glyph.planeBounds.right - glyph.planeBounds.left;\n\t\th = glyph.planeBounds.top - glyph.planeBounds.bottom;\n\t\tfontMets[id].lbwh = [l, b, w, h];\n\t}\n} // initText()\n\nexport async function init(gl) {\n\t//initial setup: only at the startup of the component\n\tsliceShader = new Shader(gl, vertSliceShader, fragSliceShader);\n\tsliceShader.use(gl);\n\tgl.uniform1i(sliceShader.uniforms[\"volume\"], 0);\n\tgl.uniform1i(sliceShader.uniforms[\"colormap\"], 1);\n\tgl.uniform1i(sliceShader.uniforms[\"overlay\"], 2);\n\tlineShader = new Shader(gl, vertLineShader, fragLineShader);\n\trenderShader = new Shader(gl, vertRenderShader, fragRenderShader);\n\trenderShader.use(gl);\n\tgl.uniform1i(renderShader.uniforms[\"volume\"], 0);\n\tgl.uniform1i(renderShader.uniforms[\"colormap\"], 1);\n\tgl.uniform1i(renderShader.uniforms[\"overlay\"], 2);\n\tcolorbarShader = new Shader(gl, vertColorbarShader, fragColorbarShader);\n\tcolorbarShader.use(gl);\n\tgl.uniform1i(colorbarShader.uniforms[\"colormap\"], 1);\n\t//multi-channel signed distance font https://github.com/Chlumsky/msdfgen\n\tfontShader = new Shader(gl, vertFontShader, fragFontShader);\n\tfontShader.use(gl);\n\tgl.uniform1i(fontShader.uniforms[\"fontTexture\"], 3);\n\tawait initText(gl);\n} // init()\n\nexport function updateGLVolume(gl, overlayItem) { //load volume or change contrast\n\tvar cubeStrip = [0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0];\n\tvar vao = gl.createVertexArray();\n\tgl.bindVertexArray(vao);\n\tvar vbo = gl.createBuffer();\n\tgl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array(cubeStrip), gl.STATIC_DRAW);\n\tgl.enableVertexAttribArray(0);\n\tgl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);\n\tvar hdr = overlayItem.volume.hdr\n\tvar img = overlayItem.volume.img\n\t// var vox = hdr.dims[1] * hdr.dims[2] * hdr.dims[3];\n\tvar imgRaw = null\n\tif (hdr.datatypeCode === 2) //data already uint8\n\t\timgRaw = new Uint8Array(img);\n\telse if (hdr.datatypeCode === 4)\n\t\timgRaw = new Int16Array(img);\n\telse if (hdr.datatypeCode === 16)\n\t\timgRaw = new Float32Array(img);\n\telse if (hdr.datatypeCode === 512)\n\t\timgRaw = new Uint16Array(img);\n\tcalibrateIntensity(imgRaw, overlayItem)\n\tvar img8 = scaleTo8Bit(imgRaw, overlayItem)\n\tif (volumeTexture)\n\t\tgl.deleteTexture(volumeTexture);\n\tvolumeTexture = gl.createTexture();\n\tgl.activeTexture(gl.TEXTURE0);\n\tgl.bindTexture(gl.TEXTURE_3D, volumeTexture);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_R, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\tgl.pixelStorei(gl.UNPACK_ALIGNMENT, 1)\n\tgl.texStorage3D(gl.TEXTURE_3D, 1, gl.R8, hdr.dims[1], hdr.dims[2], hdr.dims[3]);\n\tgl.texSubImage3D(gl.TEXTURE_3D, 0, 0, 0, 0, hdr.dims[1], hdr.dims[2], hdr.dims[3], gl.RED, gl.UNSIGNED_BYTE, img8);\n\t//overlay texture\n\tlet imgRGBA8 = overlayRGBA(overlayItem)\n\tif (overlayTexture)\n\t\tgl.deleteTexture(overlayTexture);\n\toverlayTexture = gl.createTexture();\n\tgl.activeTexture(gl.TEXTURE2);\n\tgl.bindTexture(gl.TEXTURE_3D, overlayTexture);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_R, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\tgl.pixelStorei(gl.UNPACK_ALIGNMENT, 1)\n\tgl.texStorage3D(gl.TEXTURE_3D, 4, gl.RGBA8, hdr.dims[1], hdr.dims[2], hdr.dims[3]);\n\tgl.texSubImage3D(gl.TEXTURE_3D, 0, 0, 0, 0, hdr.dims[1], hdr.dims[2], hdr.dims[3], gl.RGBA, gl.UNSIGNED_BYTE, imgRGBA8);\n\tdrawSlices(gl, overlayItem)\n} // updateVolume()\n\nexport function selectColormap(gl, lutName = \"\") {\n\tvar lut = makeLut([0, 255], [0, 255], [0, 255], [0, 128], [0, 255]); //gray\n\tif (lutName === \"Winter\")\n\t\tlut = makeLut([0, 0, 0], [0, 128, 255], [255, 196, 128], [0, 64, 128], [0, 128, 255]); //winter\n\tif (lutName === \"Warm\")\n\t\tlut = makeLut([255, 255, 255], [127, 196, 254], [0, 0, 0], [0, 64, 128], [0, 128, 255]); //warm\n\tif (lutName === \"Plasma\")\n\t\tlut = makeLut([13, 156, 237, 240], [8, 23, 121, 249], [135, 158, 83, 33], [0, 56, 80, 88], [0, 64, 192, 255]); //plasma\n\tif (lutName === \"Viridis\")\n\t\tlut = makeLut([68, 49, 53, 253], [1, 104, 183, 231], [84, 142, 121, 37], [0, 56, 80, 88], [0, 65, 192, 255]);//viridis\n\tif (lutName === \"Inferno\")\n\t\tlut = makeLut([0, 120, 237, 240], [0, 28, 105, 249], [4, 109, 37, 33], [0, 56, 80, 88], [0, 64, 192, 255]);//inferno\n\tif (colormapTexture !== null)\n\t\tgl.deleteTexture(colormapTexture);\n\tcolormapTexture = gl.createTexture();\n\tgl.activeTexture(gl.TEXTURE1);\n\tgl.bindTexture(gl.TEXTURE_2D, colormapTexture);\n\tgl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, 256, 1);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_R, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, 256, 1, gl.RGBA, gl.UNSIGNED_BYTE, lut);\n\tconsole.log(\"set colormap\", lutName)\n} // selectColormap()\n\nfunction makeLut(Rs, Gs, Bs, As, Is) {\n\t//create color lookup table provided arrays of reds, greens, blues, alphas and intensity indices\n\t//intensity indices should be in increasing order with the first value 0 and the last 255.\n\t// makeLut([0, 255], [0, 0], [0,0], [0,128],[0,255]); //red gradient\n\tvar lut = new Uint8ClampedArray(256 * 4);\n\tfor (var i = 0; i < (Is.length - 1); i++) {\n\t\t//return a + f * (b - a);\n\t\tvar idxLo = Is[i];\n\t\tvar idxHi = Is[i + 1];\n\t\tvar idxRng = idxHi - idxLo;\n\t\tvar k = idxLo * 4;\n\t\tfor (var j = idxLo; j <= idxHi; j++) {\n\t\t\tvar f = (j - idxLo) / idxRng;\n\t\t\tlut[k] = Rs[i] + f * (Rs[i + 1] - Rs[i]); //Red\n\t\t\tk++;\n\t\t\tlut[k] = Gs[i] + f * (Gs[i + 1] - Gs[i]); //Green\n\t\t\tk++;\n\t\t\tlut[k] = Bs[i] + f * (Bs[i + 1] - Bs[i]); //Blue\n\t\t\tk++;\n\t\t\tlut[k] = As[i] + f * (As[i + 1] - As[i]); //Alpha\n\t\t\tk++;\n\t\t}\n\t}\n\t//console.log(lut)\n\treturn lut;\n} // makeLut()\n\nfunction sliceScale(gl, overlayItem) {\n\tvar hdr = overlayItem.volume.hdr\n\t//console.log(\"viewport (w,h):\", gl.canvas.width, gl.canvas.height)\n\tvar dims = [1.0, hdr.dims[1] * hdr.pixDims[1], hdr.dims[2] * hdr.pixDims[2], hdr.dims[3] * hdr.pixDims[3]];\n\tvar longestAxis = Math.max(dims[1], Math.max(dims[2], dims[3]));\n\tvar volScale = [dims[1] / longestAxis, dims[2] / longestAxis, dims[3] / longestAxis];\n\tvolScale = volScale.map(function(v) {return v * volScaleMultiplier;})\n\tvar vox = [hdr.dims[1], hdr.dims[2], hdr.dims[3]];\n\treturn { volScale, vox }\n} // sliceScale()\n\nexport function mouseMPScroll(scrollVal, x, y) {\n  var gl = getGL()\n  var overlayItem = _overlayItem\n\tif (sliceType === sliceTypeRender)\n\t\treturn\n\t//console.log(\"Click pixels (x,y):\", x, y);\n\tif ((numScreenSlices < 1) || (gl.canvas.height < 1) || (gl.canvas.width < 1))\n\t\treturn;\n\t//mouse click X,Y in screen coordinates, origin at top left\n\t// webGL clip space L,R,T,B = [-1, 1, 1, 1]\n\t// n.b. webGL Y polarity reversed\n\t// https://webglfundamentals.org/webgl/lessons/webgl-fundamentals.html\n\tfor (let i = 0; i < numScreenSlices; i++) {\n\t\tvar axCorSag = screenSlices[i].axCorSag;\n\t\tif (axCorSag > sliceTypeSagittal) continue;\n\t\tvar ltwh = screenSlices[i].leftTopWidthHeight;\n\t\tlet isMirror = false;\n\t\tif (ltwh[2] < 0) {\n\t\t\tisMirror = true;\n\t\t\tltwh[0] += ltwh[2];\n\t\t\tltwh[2] = - ltwh[2];\n\t\t}\n\t\tvar fracX = (x - ltwh[0]) / ltwh[2];\n\t\tif (isMirror) fracX = 1.0 - fracX;\n\t\tvar fracY = 1.0 - ((y - ltwh[1]) / ltwh[3]);\n\n\t\tif ((fracX >= 0.0) && (fracX < 1.0) && (fracY >= 0.0) && (fracY < 1.0)) { //user clicked on slice i\n      var posNow = crosshairPos[axCorSag]\n      var posFuture = posNow + scrollVal\n      if (posFuture > 1) posFuture = 1;\n      if (posFuture < 0) posFuture = 0;\n\t\t\tif (axCorSag === sliceTypeAxial) {\n\t\t\t\t//crosshairPos[0] = fracX;\n\t\t\t\t//crosshairPos[1] = fracY;\n        crosshairPos[2] = posFuture\n\t\t\t}\n\t\t\tif (axCorSag === sliceTypeCoronal) {\n\t\t\t\t//crosshairPos[0] = fracX;\n\t\t\t\t//crosshairPos[2] = fracY;\n        crosshairPos[1] = posFuture\n\t\t\t}\n\t\t\tif (axCorSag === sliceTypeSagittal) {\n\t\t\t\t//crosshairPos[1] = fracX;\n\t\t\t\t//crosshairPos[2] = fracY;\n        crosshairPos[0] = posFuture\n\t\t\t}\n\t\t\tdrawSlices(gl, overlayItem);\n\t\t\treturn;\n\t\t} //if click in slice i\n\t} //for i: each slice on screen\n} // mouseMPScroll()\n\n\nexport function mouseClick(gl, overlayItem, x, y) {\n\tif (sliceType === sliceTypeRender)\n\t\treturn\n\t//console.log(\"Click pixels (x,y):\", x, y);\n\tif ((numScreenSlices < 1) || (gl.canvas.height < 1) || (gl.canvas.width < 1))\n\t\treturn;\n\t//mouse click X,Y in screen coordinates, origin at top left\n\t// webGL clip space L,R,T,B = [-1, 1, 1, 1]\n\t// n.b. webGL Y polarity reversed\n\t// https://webglfundamentals.org/webgl/lessons/webgl-fundamentals.html\n\tfor (let i = 0; i < numScreenSlices; i++) {\n\t\tvar axCorSag = screenSlices[i].axCorSag;\n\t\tif (axCorSag > sliceTypeSagittal) continue;\n\t\tvar ltwh = screenSlices[i].leftTopWidthHeight;\n\t\tlet isMirror = false;\n\t\tif (ltwh[2] < 0) {\n\t\t\tisMirror = true;\n\t\t\tltwh[0] += ltwh[2];\n\t\t\tltwh[2] = - ltwh[2];\n\t\t}\n\t\tvar fracX = (x - ltwh[0]) / ltwh[2];\n\t\tif (isMirror) fracX = 1.0 - fracX;\n\t\tvar fracY = 1.0 - ((y - ltwh[1]) / ltwh[3]);\n\t\tif ((fracX >= 0.0) && (fracX < 1.0) && (fracY >= 0.0) && (fracY < 1.0)) { //user clicked on slice i\n\t\t\tif (axCorSag === sliceTypeAxial) {\n\t\t\t\tcrosshairPos[0] = fracX;\n\t\t\t\tcrosshairPos[1] = fracY;\n\t\t\t}\n\t\t\tif (axCorSag === sliceTypeCoronal) {\n\t\t\t\tcrosshairPos[0] = fracX;\n\t\t\t\tcrosshairPos[2] = fracY;\n\t\t\t}\n\t\t\tif (axCorSag === sliceTypeSagittal) {\n\t\t\t\tcrosshairPos[1] = fracX;\n\t\t\t\tcrosshairPos[2] = fracY;\n\t\t\t}\n\t\t\tdrawSlices(gl, overlayItem);\n\t\t\treturn;\n\t\t} //if click in slice i\n\t} //for i: each slice on screen\n} // mouseClick()\n\nfunction drawColorbar(gl, leftTopWidthHeight) {\n\tif ((leftTopWidthHeight[2] <= 0) || (leftTopWidthHeight[3] <= 0))\n\t\treturn;\n\t//console.log(\"bar:\", leftTopWidthHeight[0], leftTopWidthHeight[1], leftTopWidthHeight[2], leftTopWidthHeight[3]);\n\tif (crosshairWidth > 0) {\n\t\t//gl.disable(gl.DEPTH_TEST);\n\t\tlineShader.use(gl)\n\t\tgl.uniform4fv(lineShader.uniforms[\"lineColor\"], crosshairColor);\n\t\tgl.uniform2fv(lineShader.uniforms[\"canvasWidthHeight\"], [gl.canvas.width, gl.canvas.height]);\n\t\tlet ltwh = [leftTopWidthHeight[0]-1, leftTopWidthHeight[1]-1, leftTopWidthHeight[2]+2, leftTopWidthHeight[3]+2];\n\t\tgl.uniform4f(lineShader.uniforms[\"leftTopWidthHeight\"], ltwh[0], ltwh[1], ltwh[2], ltwh[3]);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 5, 4);\n\t}\n\tcolorbarShader.use(gl);\n\tgl.uniform2fv(colorbarShader.uniforms[\"canvasWidthHeight\"], [gl.canvas.width, gl.canvas.height]);\n\tgl.uniform4f(colorbarShader.uniforms[\"leftTopWidthHeight\"], leftTopWidthHeight[0], leftTopWidthHeight[1], leftTopWidthHeight[2], leftTopWidthHeight[3]);\n\tgl.drawArrays(gl.TRIANGLE_STRIP, 5, 4);\n\t//gl.enable(gl.DEPTH_TEST);\n} // drawColorbar()\n\nfunction textWidth(scale, str) {\n\tlet w = 0;\n\tvar bytes = new Buffer(str);\n\tfor (let i = 0; i < str.length; i++)\n\t\tw += scale * fontMets[bytes[i]].xadv;\n\treturn w;\n} // textWidth()\n\nfunction drawChar(gl, xy, scale, char) { //draw single character, never call directly: ALWAYS call from drawText()\n\tlet metrics = fontMets[char];\n\tlet l = xy[0] + (scale * metrics.lbwh[0]);\n\tlet b = -(scale * metrics.lbwh[1]);\n\tlet w = (scale * metrics.lbwh[2]);\n\tlet h = (scale * metrics.lbwh[3]);\n\tlet t = xy[1] + (b - h) + scale;\n\tgl.uniform4f(fontShader.uniforms[\"leftTopWidthHeight\"], l, t, w, h);\n\tgl.uniform4fv(fontShader.uniforms[\"uvLeftTopWidthHeight\"], metrics.uv_lbwh);\n\tgl.drawArrays(gl.TRIANGLE_STRIP, 5, 4);\n\treturn scale * metrics.xadv;\n} // drawChar()\n\nfunction drawText(gl, xy, str) { //to right of x, vertically centered on y\n\tif (textHeight <= 0) return;\n\tfontShader.use(gl);\n\tlet scale = (textHeight * gl.canvas.height);\n\tgl.uniform2f(fontShader.uniforms[\"canvasWidthHeight\"], gl.canvas.width, gl.canvas.height);\n\tgl.uniform4fv(fontShader.uniforms[\"fontColor\"], crosshairColor);\n\tlet screenPxRange = scale / fontMets.size * fontMets.distanceRange;\n\tscreenPxRange = Math.max(screenPxRange, 1.0) //screenPxRange() must never be lower than 1\n\tgl.uniform1f(fontShader.uniforms[\"screenPxRange\"], screenPxRange);\n\tvar bytes = new Buffer(str);\n\tfor (let i = 0; i < str.length; i++)\n\t\txy[0] += drawChar(gl, xy, scale, bytes[i]);\n} // drawText()\n\nfunction drawTextRight(gl, xy, str) { //to right of x, vertically centered on y\n\tif (textHeight <= 0) return;\n\tfontShader.use(gl)\n\txy[1] -= (0.5 * textHeight * gl.canvas.height);\n\tdrawText(gl, xy, str)\n} // drawText()\n\nfunction drawTextBelow(gl, xy, str) { //horizontally centered on x, below y\n\tif (textHeight <= 0) return;\n\tfontShader.use(gl)\n\tlet scale = (textHeight * gl.canvas.height);\n\txy[0] -= 0.5 * textWidth(scale, str);\n\tdrawText(gl, xy, str)\n} // drawTextBelow()\n\nfunction draw2D(gl, leftTopWidthHeight, axCorSag) {\n\tvar crossXYZ = [crosshairPos[0], crosshairPos[1],crosshairPos[2]]; //axial: width=i, height=j, slice=k\n\tif (axCorSag === sliceTypeCoronal)\n\t\tcrossXYZ = [crosshairPos[0], crosshairPos[2],crosshairPos[1]]; //coronal: width=i, height=k, slice=j\n\tif (axCorSag === sliceTypeSagittal)\n\t\tcrossXYZ = [crosshairPos[1], crosshairPos[2],crosshairPos[0]]; //sagittal: width=j, height=k, slice=i\n\tlet isMirrorLR = ((isRadiologicalConvention) && (axCorSag < sliceTypeSagittal))\n\tsliceShader.use(gl);\n\tgl.uniform1f(sliceShader.uniforms[\"opacity\"], sliceOpacity);\n\tgl.uniform1i(sliceShader.uniforms[\"axCorSag\"], axCorSag);\n\tgl.uniform1f(sliceShader.uniforms[\"slice\"], crossXYZ[2]);\n\tgl.uniform2fv(sliceShader.uniforms[\"canvasWidthHeight\"], [gl.canvas.width, gl.canvas.height]);\n\tif (isMirrorLR) {\n\t\tgl.disable(gl.CULL_FACE);\n\t\tleftTopWidthHeight[2] = - leftTopWidthHeight[2];\n\t\tleftTopWidthHeight[0] = leftTopWidthHeight[0] - leftTopWidthHeight[2];\n\t}\n\tgl.uniform4f(sliceShader.uniforms[\"leftTopWidthHeight\"], leftTopWidthHeight[0], leftTopWidthHeight[1], leftTopWidthHeight[2], leftTopWidthHeight[3]);\n\t//console.log(leftTopWidthHeight);\n\t//gl.uniform4f(sliceShader.uniforms[\"leftTopWidthHeight\"], leftTopWidthHeight[0], leftTopWidthHeight[1], leftTopWidthHeight[2], leftTopWidthHeight[3]);\n\t//gl.drawArrays(gl.TRIANGLE_STRIP, 5, 4);\n\tgl.drawArrays(gl.TRIANGLE_STRIP, 5, 4);\n\t//record screenSlices to detect mouse click positions\n\tscreenSlices[numScreenSlices].leftTopWidthHeight = leftTopWidthHeight;\n\tscreenSlices[numScreenSlices].axCorSag = axCorSag;\n\tnumScreenSlices += 1;\n\tif (crosshairWidth <= 0.0) return;\n\tlineShader.use(gl)\n\tgl.uniform4fv(lineShader.uniforms[\"lineColor\"], crosshairColor);\n\tgl.uniform2fv(lineShader.uniforms[\"canvasWidthHeight\"], [gl.canvas.width, gl.canvas.height]);\n\t//vertical line of crosshair:\n\tvar xleft = leftTopWidthHeight[0] + (leftTopWidthHeight[2] * crossXYZ[0]);\n\tgl.uniform4f(lineShader.uniforms[\"leftTopWidthHeight\"], xleft - (0.5*crosshairWidth), leftTopWidthHeight[1],  crosshairWidth, leftTopWidthHeight[3]);\n\tgl.drawArrays(gl.TRIANGLE_STRIP, 5, 4);\n\t//horizontal line of crosshair:\n\tvar xtop = leftTopWidthHeight[1] + (leftTopWidthHeight[3] * (1.0 - crossXYZ[1]));\n\tgl.uniform4f(lineShader.uniforms[\"leftTopWidthHeight\"], leftTopWidthHeight[0], xtop - (0.5*crosshairWidth), leftTopWidthHeight[2],  crosshairWidth);\n\tgl.drawArrays(gl.TRIANGLE_STRIP, 5, 4);\n\tgl.enable(gl.CULL_FACE);\n\tif (isMirrorLR)\n\t\tdrawTextRight(gl, [leftTopWidthHeight[0] +leftTopWidthHeight[2] + 1, leftTopWidthHeight[1] + (0.5 * leftTopWidthHeight[3]) ], \"R\");\n\telse if (axCorSag < sliceTypeSagittal)\n\t\tdrawTextRight(gl, [leftTopWidthHeight[0] + 1, leftTopWidthHeight[1] + (0.5 * leftTopWidthHeight[3]) ], \"L\");\n\tif ( axCorSag === sliceTypeAxial)\n\t\tdrawTextBelow(gl, [leftTopWidthHeight[0] + (0.5 * leftTopWidthHeight[2]), leftTopWidthHeight[1] + 1 ], \"A\");\n\tif ( axCorSag > sliceTypeAxial)\n\t\tdrawTextBelow(gl, [leftTopWidthHeight[0] + (0.5 * leftTopWidthHeight[2]), leftTopWidthHeight[1] + 1 ], \"S\");\n} // draw2D()\n\nfunction draw3D(gl, overlayItem) {\n\tlet {volScale, vox} = sliceScale(gl, overlayItem);\n\trenderShader.use(gl);\n\tif (gl.canvas.width < gl.canvas.height) // screen aspect ratio\n\t\tgl.viewport(0, (gl.canvas.height - gl.canvas.width)* 0.5, gl.canvas.width, gl.canvas.width);\n\telse\n\t\tgl.viewport((gl.canvas.width - gl.canvas.height)* 0.5, 0, gl.canvas.height, gl.canvas.height);\n\tgl.clearColor(0.2, 0, 0, 1);\n\tvar m = mat.mat4.create();\n\tvar fDistance = -0.54;\n\t//modelMatrix *= TMat4.Translate(0, 0, -fDistance);\n\tmat.mat4.translate(m,m, [0, 0, fDistance]);\n\t// https://glmatrix.net/docs/module-mat4.html  https://glmatrix.net/docs/mat4.js.html\n\tvar rad = (90-renderElevation-volScale[0]) * Math.PI / 180;\n\tmat.mat4.rotate(m,m, rad, [-1, 0, 0]);\n\trad = (renderAzimuth) * Math.PI / 180;\n\tmat.mat4.rotate(m,m, rad, [0, 0, 1]);\n\tmat.mat4.scale(m, m, volScale); // volume aspect ratio\n\t//compute ray direction\n\tvar inv = mat.mat4.create();\n\tmat.mat4.invert(inv, m);\n\tvar rayDir4 = mat.vec4.fromValues(0,0,-1,1);\n\tmat.vec4.transformMat4(rayDir4, rayDir4, inv);\n\tvar rayDir = mat.vec3.fromValues(rayDir4[0],rayDir4[1],rayDir4[2]);\n\tmat.vec3.normalize(rayDir, rayDir);\n\t//defuzz, avoid divide by zero\n\tconst tiny = 0.00001;\n\tif (Math.abs(rayDir[0]) < tiny) rayDir[0] = tiny;\n\tif (Math.abs(rayDir[1]) < tiny) rayDir[1] = tiny;\n\tif (Math.abs(rayDir[2]) < tiny) rayDir[2] = tiny;\n\t//console.log( \">>\", renderAzimuth, \" : \", renderElevation, \">>>> \", rayDir);\n\t//gl.disable(gl.DEPTH_TEST);\n\t//gl.enable(gl.CULL_FACE);\n\t//gl.cullFace(gl.FRONT);\n\tgl.uniformMatrix4fv(renderShader.uniforms[\"mvpMtx\"], false, m);\n\tgl.uniform1f(renderShader.uniforms[\"overlays\"], overlays);\n\tgl.uniform4fv(renderShader.uniforms[\"clipPlane\"], clipPlane);\n\tgl.uniform3fv(renderShader.uniforms[\"rayDir\"], rayDir);\n\tgl.uniform3fv(renderShader.uniforms[\"texVox\"], vox);\n\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 14); //cube is 12 triangles, triangle-strip creates n-2 triangles\n\tlet posString = 'azimuth: ' + renderAzimuth.toFixed(0)+' elevation: '+renderElevation.toFixed(0);\n\tbus.$emit('crosshair-pos-change', posString);\n\treturn posString;\n} // draw3D()\n\nfunction frac2mm(overlayItem) {\n\t//compute crosshair in mm, not fractions:\n\tlet pos = mat.vec4.fromValues(crosshairPos[0],crosshairPos[1],crosshairPos[2],1);\n\tlet d = overlayItem.volume.hdr.dims;\n\tlet dim = mat.vec4.fromValues(d[1], d[2], d[3], 1);\n\tlet sf = overlayItem.volume.hdr.affine;\n\tlet sform = mat.mat4.fromValues(\n\t\tsf[0][0], sf[1][0], sf[2][0], sf[3][0],\n\t\tsf[0][1], sf[1][1], sf[2][1], sf[3][1],\n\t\tsf[0][2], sf[1][2], sf[2][2], sf[3][2],\n\t\tsf[0][3], sf[1][3], sf[2][3], sf[3][3]);\n\tmat.vec4.mul(pos, pos, dim);\n\tlet shim = mat.vec4.fromValues(-0.5, -0.5, -0.5, 0); //bitmap with 5 voxels scaled 0..1, voxel centers are 0.1,0.3,0.5,0.7,0.9\n\tmat.vec4.add(pos, pos, shim);\n\tmat.vec4.transformMat4(pos, pos, sform);\n\treturn pos;\n} // frac2mm()\n\nfunction scaleSlice(gl, w, h) {\n\tlet scalePix = gl.canvas.clientWidth / w;\n\tif ((h * scalePix) > gl.canvas.clientHeight)\n\t\tscalePix = gl.canvas.clientHeight / h;\n\t//canvas space is 0,0...w,h with origin at upper left\n\tlet wPix = w * scalePix;\n\tlet hPix = h * scalePix;\n\tlet leftTopWidthHeight = [(gl.canvas.clientWidth-wPix) * 0.5, ((gl.canvas.clientHeight-hPix) * 0.5), wPix, hPix];\n\t//let leftTopWidthHeight = [(gl.canvas.clientWidth-wPix) * 0.5, 80, wPix, hPix];\n\treturn leftTopWidthHeight;\n} // scaleSlice()\n\nexport function drawSlices(gl, overlayItem) {\n\tgl.clearColor(backColor[0], backColor[1], backColor[2], backColor[3]);\n\tgl.clear(gl.COLOR_BUFFER_BIT);\n\tif (sliceType === sliceTypeRender) //draw rendering\n\t\treturn draw3D(gl, overlayItem);\n\tlet {volScale} = sliceScale(gl, overlayItem);\n\tgl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\tnumScreenSlices = 0;\n\tif (sliceType === sliceTypeAxial) { //draw axial\n\t\tlet leftTopWidthHeight = scaleSlice(gl, volScale[0], volScale[1]);\n\t\tdraw2D(gl, leftTopWidthHeight, 0);\n\t} else if (sliceType === sliceTypeCoronal) { //draw coronal\n\t\tlet leftTopWidthHeight = scaleSlice(gl, volScale[0], volScale[2]);\n\t\tdraw2D(gl, leftTopWidthHeight, 1);\n\t} else if (sliceType === sliceTypeSagittal) { //draw sagittal\n\t\tlet leftTopWidthHeight = scaleSlice(gl, volScale[1], volScale[2]);\n\t\tdraw2D(gl, leftTopWidthHeight, 2);\n\t} else { //sliceTypeMultiplanar\n\t\tlet ltwh = scaleSlice(gl, volScale[0]+volScale[1], volScale[1]+volScale[2]);\n\t\tlet wX = ltwh[2] * volScale[0]/(volScale[0]+volScale[1]);\n\t\tlet wY = ltwh[2] - wX;\n\t\tlet hY = ltwh[3] * volScale[1]/(volScale[1]+volScale[2]);\n\t\tlet hZ = ltwh[3] - hY;\n\t\t//draw axial\n\t\tdraw2D(gl, [ltwh[0],ltwh[1]+hZ, wX, hY], 0);\n\t\t//draw coronal\n\t\tdraw2D(gl, [ltwh[0],ltwh[1], wX, hZ], 1);\n\t\t//draw sagittal\n\t\tdraw2D(gl, [ltwh[0]+wX,ltwh[1], wY, hZ], 2);\n\t\t//draw colorbar (optional)\n\t\tvar margin = colorBarMargin * hY;\n\t\tdrawColorbar(gl, [ltwh[0]+wX+margin, ltwh[1] + hZ + margin, wY - margin - margin, hY * colorbarHeight]);\n\t\t// drawTextBelow(gl, [ltwh[0]+ wX + (wY * 0.5), ltwh[1] + hZ + margin + hY * colorbarHeight], \"Syzygy\"); //DEMO\n\t}\n\tgl.finish();\n\tlet pos = frac2mm(overlayItem);\n\tlet posString = pos[0].toFixed(2)+''+pos[1].toFixed(2)+''+pos[2].toFixed(2);\n\t// temporary event bus mechanism. It uses Vue, but it would be ideal to divorce vue from this gl code.\n\tbus.$emit('crosshair-pos-change', posString);\n\treturn posString\n} // drawSlices()\n\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./controls.vue?vue&type=style&index=0&id=4b65bab5&scoped=true&lang=css&\"","import Vue from 'vue';\nexport const bus = new Vue();\n"],"sourceRoot":""}