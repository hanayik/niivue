(function(t){function e(e){for(var s,o,r=e[0],l=e[1],h=e[2],u=0,d=[];u<r.length;u++)o=r[u],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&d.push(n[o][0]),n[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);c&&c(e);while(d.length)d.shift()();return a.push.apply(a,h||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],s=!0,r=1;r<i.length;r++){var l=i[r];0!==n[l]&&(s=!1)}s&&(a.splice(e--,1),t=o(o.s=i[0]))}return t}var s={},n={app:0},a=[];function o(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=s,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(i,s,function(e){return t[e]}.bind(null,s));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var c=l;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"22fb":function(t,e,i){"use strict";i("739a")},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var s=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-app",[i("v-app-bar",{attrs:{app:""}},[i("h2",[t._v("Niivue")]),i("v-spacer")],1),i("v-main",[i("v-row",{staticStyle:{height:"100%"}},[i("v-col",{attrs:{sm:"12",md:"12",lg:"4"}},[i("controls",{attrs:{overlays:t.urlOverlayList}})],1),i("v-col",{attrs:{sm:"12",md:"12",lg:"8"}},[i("v-toolbar",{staticClass:"pa-0 ma-0",attrs:{elevation:"0"}},[i("v-btn",{on:{click:function(e){return t.setSliceType(0)}}},[t._v("A")]),i("v-btn",{on:{click:function(e){return t.setSliceType(2)}}},[t._v("S")]),i("v-btn",{on:{click:function(e){return t.setSliceType(1)}}},[t._v("C")]),i("v-btn",{on:{click:function(e){return t.setSliceType(4)}}},[t._v("R")]),i("v-btn",{on:{click:function(e){return t.setSliceType(3)}}},[t._v("MP")]),i("v-spacer")],1),1==t.viewShown2D||1==t.viewShown3D?i("v-expansion-panels",[i("v-expansion-panel",[i("v-expansion-panel-header",[i("v-row",{staticClass:"align-center",attrs:{"no-gutters":""}},[t._v(" Controls "),i("v-icon",{staticClass:"mx-2"},[t._v(" mdi-arrow-expand-vertical ")])],1)],1),i("v-expansion-panel-content",[1==t.viewShown2D?i("v-row",[i("v-slider",{attrs:{step:"0.01",max:"1",min:"0","thumb-label":"",label:"slice"},on:{input:t.onSliceSlider2D},model:{value:t.sliceScrollVal,callback:function(e){t.sliceScrollVal=e},expression:"sliceScrollVal"}})],1):t._e(),1==t.viewShown3D?i("v-row",[i("v-slider",{attrs:{step:"1",max:"360",min:"0","thumb-label":"",label:"clip Azimu"},on:{input:t.onClipPlaneChange},model:{value:t.clipValAz,callback:function(e){t.clipValAz=e},expression:"clipValAz"}})],1):t._e(),1==t.viewShown3D?i("v-row",[i("v-slider",{attrs:{step:"1",max:"90",min:"-90","thumb-label":"",label:"clip Eleva"},on:{input:t.onClipPlaneChange},model:{value:t.clipValEl,callback:function(e){t.clipValEl=e},expression:"clipValEl"}})],1):t._e(),1==t.viewShown3D?i("v-row",[i("v-slider",{attrs:{step:"0.005",max:"0.5",min:"0","thumb-label":"",label:"clip Depth"},on:{input:t.onClipPlaneChange},model:{value:t.clipValDepth,callback:function(e){t.clipValDepth=e},expression:"clipValDepth"}})],1):t._e(),i("v-row",[t.viewShown3D?i("v-btn",{staticClass:"mx-auto",on:{click:t.onResetClipPlane}},[t._v("reset")]):t._e()],1)],1)],1)],1):t._e(),i("glviewer",{attrs:{overlays:t.urlOverlayList}})],1)],1)],1),i("v-footer",{attrs:{app:""}},[i("v-row",[i("v-col",{attrs:{align:"center",justify:"center"}},[i("span",{staticClass:"text-caption"},[t._v(t._s(t.coordinateString))])])],1)],1)],1)},a=[],o=(i("1276"),i("ac1f"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mt-5",attrs:{id:"controls"}},[i("v-row",{staticClass:"my-2 mx-2 align-center"},[i("h3",[t._v("Layers")]),i("v-spacer"),i("v-btn",{staticClass:"mx-2",attrs:{small:""},on:{click:t.onAddOverlay}},[t._v("Add overlay")])],1),i("v-row",{attrs:{"no-gutters":""}},[i("v-expansion-panels",[i("draggable",{staticClass:"row mx-2 my-2",attrs:{handle:".drag-handle"},model:{value:t.overlays,callback:function(e){t.overlays=e},expression:"overlays"}},t._l(t.overlays,(function(e,s){return i("v-expansion-panel",{key:s},[i("v-expansion-panel-header",[i("v-row",{staticClass:"align-center",attrs:{"no-gutters":""}},[i("v-icon",{staticClass:"mx-2 drag-handle"},[t._v(" mdi-drag-horizontal-variant ")]),i("v-icon",{staticClass:"mx-2",on:{click:function(e){return e.stopPropagation(),t.toggleEye(e)}}},[t._v(" "+t._s(t.eyeIcon)+" ")]),t._v(t._s(e.name)+" ")],1)],1),i("v-expansion-panel-content",[i("v-row",[i("v-select",{attrs:{items:t.colorMaps,label:"Color map"},on:{change:function(e){return t.onColorChange(s)}},model:{value:e.colorMap,callback:function(i){t.$set(e,"colorMap",i)},expression:"overlay.colorMap"}})],1),i("v-row",[i("v-col",{staticClass:"px-4"},[i("p",[t._v("Intensity range")]),i("v-range-slider",{staticClass:"align-center",attrs:{max:e.intensityMax,min:e.intensityMin,"hide-details":""},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{value:e.intensityRange[0],"hide-details":"","single-line":"",type:"number"},on:{input:function(i){return t.$set(e.intensityRange,0,i)}}})]},proxy:!0},{key:"append",fn:function(){return[i("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{value:e.intensityRange[1],"hide-details":"","single-line":"",type:"number"},on:{input:function(i){return t.$set(e.intensityRange,1,i)}}})]},proxy:!0}],null,!0),model:{value:e.intensityRange,callback:function(i){t.$set(e,"intensityRange",i)},expression:"overlay.intensityRange"}})],1)],1),i("v-row",[i("v-col",[i("p",[t._v("Opacity")]),i("v-slider",{attrs:{step:"0.01",max:"1",min:"0","thumb-label":"",ticks:""},on:{input:function(e){return t.onOpacityChange(s)}},model:{value:t.opacity,callback:function(e){t.opacity=e},expression:"opacity"}})],1)],1)],1)],1)})),1)],1)],1)],1)}),r=[],l=i("b76a"),h=i.n(l),c=new s["a"],u={props:{overlays:Array},name:"controls",components:{draggable:h.a},data:function(){return{colorMaps:["gray","Winter","Warm","Plasma","Viridis","Inferno"],eyeIcon:"mdi-eye",overlays_:this.overlays,draggable:!0,opacity:1}},methods:{toggleEye:function(){this.eyeIcon="mdi-eye"==this.eyeIcon?"mdi-eye-off":"mdi-eye"},onColorChange:function(t){console.log(t),c.$emit("colormap-change")},onOpacityChange:function(){c.$emit("opacity-change",this.opacity)},onAddOverlay:function(){alert("adding overlays in this demo is not implemented yet! :)")}}},d=u,p=(i("e45c"),i("2877")),g=i("6544"),m=i.n(g),f=i("8336"),v=i("62ad"),y=i("cd55"),x=i("49e2"),T=i("c865"),S=i("0393"),b=i("132d"),E=i("5963"),w=i("0fd9"),_=i("b974"),R=i("ba0d"),P=i("2fa4"),C=i("8654"),D=Object(p["a"])(d,o,r,!1,null,"1a446d12",null),A=D.exports;m()(D,{VBtn:f["a"],VCol:v["a"],VExpansionPanel:y["a"],VExpansionPanelContent:x["a"],VExpansionPanelHeader:T["a"],VExpansionPanels:S["a"],VIcon:b["a"],VRangeSlider:E["a"],VRow:w["a"],VSelect:_["a"],VSlider:R["a"],VSpacer:P["a"],VTextField:C["a"]});var M=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"viewer",attrs:{id:"viewer"}},[i("v-dialog",{attrs:{"max-width":"400"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[i("v-color-picker",{attrs:{width:"400",mode:"rgba"},on:{input:t.onCrosshairColorChange},model:{value:t.crosshairColor,callback:function(e){t.crosshairColor=e},expression:"crosshairColor"}})],1),i("v-dialog",{attrs:{"max-width":"400"},model:{value:t.discoMode,callback:function(e){t.discoMode=e},expression:"discoMode"}},[i("v-card",{attrs:{color:"rgba(0, 0, 0, 0.4)"}},[i("v-row",{attrs:{"no-gutters":""}},[i("v-spacer"),i("h2",{staticStyle:{color:"white"}},[t._v("Disco mode")]),i("v-spacer")],1)],1)],1)],1)},k=[],L=i("c8b5"),U=i("8f10"),V={name:"glviewer",props:{overlays:Array,shader:String},created:function(){},data:function(){return{niivue:null,selectedOverlay:0,last2DSliceVal:.5,mouseDown:!1,touchDown:!1,zDown:!1,discoMode:!1,discoModeColorMapTimer:null,discoModeCrosshairTimer:null,scale:1,dialog:!1,crosshairColor:{r:255,g:0,b:0,a:1},colorMaps:["Winter","Warm","Plasma","Viridis","Inferno"],selectedColorMap:"Winter"}},watch:{overlays:{deep:!0,handler:function(){}}},methods:{onWindowResize:function(){var t=100,e=document.querySelector("#gl"),i=document.querySelector("#viewer");e.width=i.clientWidth,e.height=i.clientHeight,i.getBoundingClientRect().bottom>document.documentElement.clientHeight&&(i.style.height=document.documentElement.clientHeight-t,e.height=document.documentElement.clientHeight-t),this.niivue.drawScene()},onCrosshairColorChange:function(){var t=[this.crosshairColor.r/255,this.crosshairColor.g/255,this.crosshairColor.b/255,this.crosshairColor.a];this.niivue.setCrosshairColor(t)}},mounted:function(){var t=this,e=document.createElement("canvas");e.classList.add("fillParent");var i=document.querySelector("#viewer");e.id="gl",e.width=i.clientWidth,e.height=i.clientHeight,i.appendChild(e);var s=document.querySelector("#gl"),n=s.getContext("webgl2"),a=new L(s);a.get("press").set({time:2e3}),a.get("pinch").set({enable:!0}),n.canvas.addEventListener("mousedown",(function(e){e.preventDefault(),t.dialog=!1,t.mouseDown=!0;var i=s.getBoundingClientRect();t.niivue.mouseClick(e.clientX-i.left,e.clientY-i.top),t.niivue.mouseDown(e.clientX-i.left,e.clientY-i.top)})),n.canvas.addEventListener("touchstart",(function(e){e.preventDefault(),t.dialog=!1,t.touchDown=!0;var i=s.getBoundingClientRect();t.niivue.mouseClick(e.touches[0].clientX-i.left,e.touches[0].clientY-i.top),t.niivue.mouseDown(e.touches[0].clientX-i.left,e.touches[0].clientY-i.top)})),n.canvas.addEventListener("mousemove",(function(e){if(t.mouseDown){var i=s.getBoundingClientRect();t.niivue.mouseClick(e.clientX-i.left,e.clientY-i.top),t.niivue.mouseMove(e.clientX-i.left,e.clientY-i.top)}})),n.canvas.addEventListener("touchmove",(function(e){if(t.touchDown&&e.touches.length<2){var i=s.getBoundingClientRect();t.niivue.mouseClick(e.touches[0].clientX-i.left,e.touches[0].clientY-i.top),t.niivue.mouseMove(e.touches[0].clientX-i.left,e.touches[0].clientY-i.top)}})),a.on("pinchin",(function(){t.niivue.sliceScroll2D(.001,null,null)})),a.on("pinchout",(function(){t.niivue.sliceScroll2D(-.001,null,null)})),n.canvas.addEventListener("wheel",(function(e){if(t.zDown)e.preventDefault(),t.scale+=-.01*e.deltaY,t.niivue.setScale(t.scale);else{e.preventDefault(),e.stopPropagation();var i=s.getBoundingClientRect();e.deltaY<0?t.niivue.sliceScroll2D(-.01,e.clientX-i.left,e.clientY-i.top):t.niivue.sliceScroll2D(.01,e.clientX-i.left,e.clientY-i.top)}})),a.on("press",(function(){t.dialog=!0})),n.canvas.addEventListener("mouseup",(function(){t.mouseDown=!1})),n.canvas.addEventListener("tocuhend",(function(){t.touchDown=!1})),window.addEventListener("keypress",(function(e){"z"===e.key&&(t.zDown=!0),"d"===e.key&&(t.discoMode=0==t.discoMode,clearInterval(t.discoModeColorMapTimer),clearInterval(t.discoModeCrosshairTimer),t.discoMode?(t.discoModeColorMapTimer=setInterval((function(){c.$emit("colormap-change",t.colorMaps[Math.floor(Math.random()*t.colorMaps.length)])}),200),t.discoModeCrosshairTimer=setInterval((function(){this.niivue.setCrosshairColor([Math.random(),Math.random(),Math.random(),1])}),200)):(c.$emit("colormap-change","gray"),t.niivue.setCrosshairColor([1,0,0,1])))})),window.addEventListener("keyup",(function(e){"z"===e.key&&(t.zDown=!1)})),window.addEventListener("resize",this.onWindowResize),this.niivue=new U["a"]({}).attachTo("#gl"),this.gl=n,this.niivue.loadVolumes(this.overlays),c.$on("opacity-change",(function(e){t.niivue.setSliceOpacity(e)})),c.$on("slice-type-change",function(t){this.niivue.setSliceType(t)}.bind(this)),c.$on("set-2D-slice",function(t){this.niivue.sliceScroll2D(t,null,null,!1)}.bind(this)),c.$on("set-clip-planes",function(t){this.niivue.clipPlaneUpdate(t)}.bind(this)),c.$on("colormap-change",function(){this.niivue.loadVolumes(this.overlays)}.bind(this)),c.$on("refresh",function(){this.niivue.loadVolumes(this.overlays)}.bind(this))}},W=V,I=(i("22fb"),i("b0af")),H=i("03a4"),F=i("169a"),X=Object(p["a"])(W,M,k,!1,null,"ab76c8f6",null),z=X.exports;m()(X,{VCard:I["a"],VColorPicker:H["a"],VDialog:F["a"],VRow:w["a"],VSpacer:P["a"]});var B={name:"App",components:{controls:A,glviewer:z},created:function(){var t=this;c.$on("crosshair-pos-change",(function(e){t.coordinateString=e}))},data:function(){return{tab:null,viewShown2D:!1,viewShown3D:!1,clipValAz:0,clipValEl:0,clipValDepth:.5,sliceScrollVal:.5,appTabs:["Menu","Draw","Edit","Scripting"],coordinateString:"0x0x0",overlayList:[{url:"./brain.nii.gz",volume:{hdr:null,img:null},name:"brain",intensityMin:0,intensityMax:100,intensityRange:[0,100],colorMap:"gray",opacity:100},{url:"./hippo.nii.gz",volume:{hdr:null,img:null},name:"hippo",intensityMin:0,intensityMax:100,intensityRange:[0,100],colorMap:"Warm",opacity:100}]}},computed:{urlOverlayList:function(){var t=[];if(void 0===this.$route.query.urls||null===this.$route.query.urls||""===this.$route.query.urls)return this.overlayList;for(var e=this.$route.query.urls.split(","),i=0;i<e.length;i++)t.push({url:e[i],volume:{hdr:null,img:null},name:e[i].split("/").pop(),intensityMin:0,intensityMax:100,intensityRange:[0,100],colorMap:"gray",opacity:100});return t.length>0?(c.$emit("refresh"),t):this.overlayList}},methods:{setSliceType:function(t){t<3?(this.viewShown2D=!0,this.viewShown3D=!1):4==t?(this.viewShown2D=!1,this.viewShown3D=!0):(this.viewShown2D=!1,this.viewShown3D=!1),c.$emit("slice-type-change",t)},onSliceSlider2D:function(){this.viewShown2D&&c.$emit("set-2D-slice",this.sliceScrollVal)},onClipPlaneChange:function(){this.viewShown3D&&c.$emit("set-clip-planes",[this.clipValAz,this.clipValEl,this.clipValDepth])},onResetClipPlane:function(){this.viewShown3D&&(this.clipValAz=0,this.clipValEl=0,this.clipValDepth=2,c.$emit("set-clip-planes",[this.clipValAz,this.clipValEl,this.clipValDepth]))}}},O=B,N=i("7496"),G=i("40dc"),$=i("553a"),j=i("f6c4"),Y=i("71d9"),q=Object(p["a"])(O,n,a,!1,null,null,null),K=q.exports;m()(q,{VApp:N["a"],VAppBar:G["a"],VBtn:f["a"],VCol:v["a"],VExpansionPanel:y["a"],VExpansionPanelContent:x["a"],VExpansionPanelHeader:T["a"],VExpansionPanels:S["a"],VFooter:$["a"],VIcon:b["a"],VMain:j["a"],VRow:w["a"],VSlider:R["a"],VSpacer:P["a"],VToolbar:Y["a"]});var Z=i("8c4f"),J=i("f309");i("bf40");s["a"].use(J["a"]);var Q=new J["a"]({});s["a"].use(Z["a"]),s["a"].config.productionTip=!1;var tt=new Z["a"]({routes:[],mode:"history"});new s["a"]({vuetify:Q,router:tt,render:function(t){return t(K)}}).$mount("#app")},6704:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));i("466d"),i("ac1f"),i("159b");var s=function(t,e,i){var s=this;this.program=n(t,e,i);var a=/uniform[^;]+[ ](\w+);/g,o=/uniform[^;]+[ ](\w+);/;this.uniforms={};var r=e.match(a),l=i.match(a);for(var h in r&&r.forEach((function(t){var e=t.match(o);s.uniforms[e[1]]=-1})),l&&l.forEach((function(t){var e=t.match(o);s.uniforms[e[1]]=-1})),this.uniforms)this.uniforms[h]=t.getUniformLocation(this.program,h)};s.prototype.use=function(t){t.useProgram(this.program)};var n=function(t,e,i){var s=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))return alert("Vertex shader failed to compile, see console for log"),console.log(t.getShaderInfoLog(s)),null;var n=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))return alert("Fragment shader failed to compile, see console for log"),console.log(t.getShaderInfoLog(n)),null;var a=t.createProgram();return t.attachShader(a,s),t.attachShader(a,n),t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)?a:(alert("Shader failed to link, see console for log"),console.log(t.getProgramInfoLog(a)),null)}},"739a":function(t,e,i){},"757a":function(t,e,i){},"8bb8":function(t,e,i){"use strict";i.d(e,"n",(function(){return s})),i.d(e,"h",(function(){return n})),i.d(e,"o",(function(){return a})),i.d(e,"i",(function(){return o})),i.d(e,"c",(function(){return r})),i.d(e,"j",(function(){return l})),i.d(e,"a",(function(){return h})),i.d(e,"l",(function(){return c})),i.d(e,"k",(function(){return u})),i.d(e,"b",(function(){return d})),i.d(e,"m",(function(){return p})),i.d(e,"g",(function(){return g})),i.d(e,"f",(function(){return m})),i.d(e,"e",(function(){return f})),i.d(e,"d",(function(){return v}));var s="#version 300 es\n#line 4\nlayout(location=0) in vec3 pos;\nuniform mat4 mvpMtx;\nout vec3 vColor;\nvoid main(void) {\n\tgl_Position = mvpMtx * vec4(2.0 * (pos.xyz - 0.5), 1.0);\n\tvColor = pos;\n}",n="#version 300 es\n#line 15\nprecision highp int;\nprecision highp float;\nuniform vec3 rayDir;\nuniform vec3 texVox;\nuniform vec4 clipPlane;\nuniform highp sampler3D volume, overlay;\nuniform float overlays;\nin vec3 vColor;\nout vec4 fColor;\nvec3 GetBackPosition (vec3 startPosition) {\n vec3 invR = 1.0 / rayDir;\n vec3 tbot = invR * (vec3(0.0)-startPosition);\n vec3 ttop = invR * (vec3(1.0)-startPosition);\n vec3 tmax = max(ttop, tbot);\n vec2 t = min(tmax.xx, tmax.yz);\n return startPosition + (rayDir * min(t.x, t.y));\n}\nvec4 applyClip (vec3 dir, inout vec4 samplePos, inout float len) {\n\tfloat cdot = dot(dir,clipPlane.xyz);\n\tif  ((clipPlane.a > 1.0) || (cdot == 0.0)) return samplePos;\n    bool frontface = (cdot > 0.0);\n\tfloat clipThick = 2.0;\n    float dis = (-clipPlane.a - dot(clipPlane.xyz, samplePos.xyz-0.5)) / cdot;\n    float  disBackFace = (-(clipPlane.a-clipThick) - dot(clipPlane.xyz, samplePos.xyz-0.5)) / cdot;\n    if (((frontface) && (dis >= len)) || ((!frontface) && (dis <= 0.0))) {\n        samplePos.a = len + 1.0;\n        return samplePos;\n    }\n    if (frontface) {\n        dis = max(0.0, dis);\n        samplePos = vec4(samplePos.xyz+dir * dis, dis);\n        len = min(disBackFace, len);\n    }\n    if (!frontface) {\n        len = min(dis, len);\n        disBackFace = max(0.0, disBackFace);\n        samplePos = vec4(samplePos.xyz+dir * disBackFace, disBackFace);\n    }\n    return samplePos;\n}\nvoid main() {\n    fColor = vec4(0.0,0.0,0.0,0.0);\n\tvec3 start = vColor;\n\t//fColor = vec4(start, 1.0); return;\n\tvec3 backPosition = GetBackPosition(start);\n\t//fColor = vec4(backPosition, 1.0); return;\n    vec3 dir = backPosition - start;\n    float len = length(dir);\n\tfloat lenVox = length((texVox * start) - (texVox * backPosition));\n\tfloat sliceSize = len / lenVox; //e.g. if ray length is 1.0 and traverses 50 voxels, each voxel is 0.02 in unit cube\n\tfloat stepSize = sliceSize; //quality: larger step is faster traversal, but fewer samples\n\tfloat opacityCorrection = stepSize/sliceSize;\n    dir = normalize(dir);\n\tvec4 deltaDir = vec4(dir.xyz * stepSize, stepSize);\n\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\tfloat lenNoClip = len;\n\tvec4 clipPos = applyClip(dir, samplePos, len);\n\t//start: OPTIONAL fast pass: rapid traversal until first hit\n\tfloat stepSizeFast = sliceSize * 1.9;\n\tvec4 deltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(volume, samplePos.xyz).r;\n\t\tif (val > 0.01) break;\n\t\tsamplePos += deltaDirFast; //advance ray position\n\t}\n\tif ((samplePos.a > len) && (overlays < 1.0)) return;\n\tsamplePos -= deltaDirFast;\n\tif (samplePos.a < 0.0)\n\t\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//end: fast pass\n\tvec4 colAcc = vec4(0.0,0.0,0.0,0.0);\n\tconst float earlyTermination = 0.95;\n\tfloat backNearest = len; //assume no hit\n    float ran = fract(sin(gl_FragCoord.x * 12.9898 + gl_FragCoord.y * 78.233) * 43758.5453);\n    samplePos += deltaDir * ran; //jitter ray\n\twhile (samplePos.a <= len) {\n\t\tvec4 colorSample = texture(volume, samplePos.xyz);\n\t\tsamplePos += deltaDir; //advance ray position\n\t\tif (colorSample.a < 0.01) continue;\n\t\tbackNearest = min(backNearest, samplePos.a);\n\t\tcolorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);\n\t\tcolorSample.rgb *= colorSample.a;\n\t\tcolAcc= (1.0 - colAcc.a) * colorSample + colAcc;\n\t\tif ( colAcc.a > earlyTermination )\n\t\t\tbreak;\n\t}\n\tcolAcc.a = colAcc.a / earlyTermination;\n\tfColor = colAcc;\n\tif (overlays < 1.0) return;\n\t//overlay pass\n\tlen = lenNoClip;\n\tsamplePos = vec4(start.xyz, 0.0); //ray position\n    //start: OPTIONAL fast pass: rapid traversal until first hit\n\tstepSizeFast = sliceSize * 1.9;\n\tdeltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(overlay, samplePos.xyz).a;\n\t\tif (val > 0.01) break;\n\t\tsamplePos += deltaDirFast; //advance ray position\n\t}\n\tif (samplePos.a > len) return;\n\tsamplePos -= deltaDirFast;\n\tif (samplePos.a < 0.0)\n\t\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//end: fast pass\n\tfloat overFarthest = len;\n\tcolAcc = vec4(0.0, 0.0, 0.0, 0.0);\n\tsamplePos += deltaDir * ran; //jitter ray\n\twhile (samplePos.a <= len) {\n\t\tvec4 colorSample = texture(overlay, samplePos.xyz);\n\t\tsamplePos += deltaDir; //advance ray position\n\t\tif (colorSample.a < 0.01) continue;\n\t\tcolorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);\n\t\tcolorSample.rgb *= colorSample.a;\n\t\tcolAcc= (1.0 - colAcc.a) * colorSample + colAcc;\n\t\toverFarthest = samplePos.a;\n\t\tif ( colAcc.a > earlyTermination )\n\t\t\tbreak;\n\t}\n\tfloat overMix = colAcc.a;\n\tfloat overlayDepth = 0.3;\n\tif (fColor.a <= 0.0)\n\t\t\toverMix = 1.0;\n\telse if (((overFarthest) > backNearest)) {\n\t\tfloat dx = (overFarthest - backNearest)/1.73;\n\t\tdx = fColor.a * pow(dx, overlayDepth);\n\t\toverMix *= 1.0 - dx;\n\t}\n\tfColor.rgb = mix(fColor.rgb, colAcc.rgb, overMix);\n\tfColor.a = max(fColor.a, colAcc.a);\n}",a="#version 300 es\n#line 150\nlayout(location=0) in vec3 pos;\nuniform int axCorSag;\nuniform float slice;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nout vec3 texPos;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tif (axCorSag == 1)\n\t\ttexPos = vec3(pos.x, slice, pos.y);\n\telse if (axCorSag == 2)\n\t\ttexPos = vec3(slice, pos.x, pos.y);\n\telse\n\t\ttexPos = vec3(pos.xy, slice);\n}",o="#version 300 es\n#line 173\nprecision highp int;\nprecision highp float;\nuniform highp sampler3D volume, overlay;\nuniform float opacity;\nin vec3 texPos;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(volume, texPos).rgb, opacity);\n\tvec4 ocolor = texture(overlay, texPos);\n\tcolor.rgb = mix(color.rgb, ocolor.rgb, ocolor.a);\n}",r="#version 300 es\n#line 189\nprecision highp int;\nprecision highp float;\nuniform vec4 lineColor;\nout vec4 color;\nvoid main() {\n\tcolor = lineColor;\n}",l="#version 300 es\n#line 200\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nout float vColor;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tvColor = pos.x;\n}",h="#version 300 es\n#line 217\nprecision highp int;\nprecision highp float;\nuniform highp sampler2D colormap;\nin float vColor;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(colormap, vec2(vColor, 0.5)).rgb, 1.0);\n}",c="#version 300 es\n#line 229\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n}",u="#version 300 es\n#line 244\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nuniform vec4 uvLeftTopWidthHeight;\nout vec2 vUV;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tvUV = vec2(uvLeftTopWidthHeight.x + (pos.x * uvLeftTopWidthHeight.z), uvLeftTopWidthHeight.y  + ((1.0 - pos.y) * uvLeftTopWidthHeight.w) );\n}",d="#version 300 es\n#line 262\nprecision highp int;\nprecision highp float;\nuniform highp sampler2D fontTexture;\nuniform vec4 fontColor;\nuniform float screenPxRange;\nin vec2 vUV;\nout vec4 color;\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\nvoid main() {\n\tvec3 msd = texture(fontTexture, vUV).rgb;\n\tfloat sd = median(msd.r, msd.g, msd.b);\n    float screenPxDistance = screenPxRange*(sd - 0.5);\n    float opacity = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n\tcolor = vec4(fontColor.rgb , fontColor.a * opacity);\n}",p="#version 300 es\n#line 283\nprecision highp int;\nprecision highp float;\nin vec3 vPos;\nout vec2 TexCoord;\nvoid main() {\n    TexCoord = vPos.xy;\n    gl_Position = vec4( (vPos.xy-vec2(0.5,0.5))* 2.0, 0.0, 1.0);\n}",g="#version 300 es\nuniform highp usampler3D intensityVol;\n",m="#version 300 es\nuniform highp isampler3D intensityVol;\n",f="#version 300 es\nuniform highp sampler3D intensityVol;\n",v="#line 309\nprecision highp int;\nprecision highp float;\nin vec2 TexCoord;\nout vec4 FragColor;\nuniform float coordZ;\nuniform float scl_slope;\nuniform float scl_inter;\nuniform float cal_max;\nuniform float cal_min;\nuniform highp sampler2D colormap;\nuniform mat4 mtx;\nvoid main(void) {\n vec4 vx = vec4(TexCoord.xy, coordZ, 1.0) * mtx;\n float f = (scl_slope * float(texture(intensityVol, vx.xyz).r)) + scl_inter;\n float r = max(0.00001, abs(cal_max - cal_min));\n float mn = min(cal_min, cal_max);\n f = mix(0.0, 1.0, (f - mn) / r);\n FragColor = texture(colormap, vec2(f, 0.5)).rgba;\n}"},"8f10":function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return l}));var s=i("1da1"),n=(i("96cf"),i("8a59"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("d3b7"),i("fb6a"),i("5cc6"),i("cfc3"),i("99af"),i("8b09"),i("4a9b"),i("20bf"),i("84c3"),i("d81d"),i("b680"),i("0037")),a=i("6704"),o=i("20e7"),r=i("8bb8"),l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e in this.opts={},this.defaults={textHeight:.03,colorbarHeight:.05,crosshairWidth:1,backColor:[0,0,0,1],crosshairColor:[1,0,0,1],colorBarMargin:.05},this.gl=null,this.colormapTexture=null,this.volumeTexture=null,this.overlayTexture=null,this.sliceShader=null,this.lineShader=null,this.renderShader=null,this.colorbarShader=null,this.fontShader=null,this.orientShaderU=null,this.orientShaderI=null,this.orientShaderF=null,this.fontMets=null,this.sliceTypeAxial=0,this.sliceTypeCoronal=1,this.sliceTypeSagittal=2,this.sliceTypeMultiplanar=3,this.sliceTypeRender=4,this.sliceType=this.sliceTypeMultiplanar,this.scene={},this.scene.renderAzimuth=120,this.scene.renderElevation=15,this.scene.crosshairPos=[.5,.5,.5],this.scene.clipPlane=[0,0,0,0],this.back={},this.overlays=[],this.volumes=[],this.isRadiologicalConvention=!1,this.volScaleMultiplier=1,this.mousePos=[0,0],this.numScreenSlices=0,this.screenSlices=[{leftTopWidthHeight:[1,0,0,1],axCorSag:this.sliceTypeAxial},{leftTopWidthHeight:[1,0,0,1],axCorSag:this.sliceTypeAxial},{leftTopWidthHeight:[1,0,0,1],axCorSag:this.sliceTypeAxial},{leftTopWidthHeight:[1,0,0,1],axCorSag:this.sliceTypeAxial}],this.sliceOpacity=1,this.defaults)this.opts[e]=void 0===t[e]?this.defaults[e]:t[e]};l.prototype.arrayEquals=function(t,e){return Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((function(t,i){return t===e[i]}))},l.prototype.mouseDown=function(t,e){this.sliceType==this.sliceTypeRender&&(this.mousePos=[t,e])},l.prototype.mouseMove=function(t,e){this.sliceType==this.sliceTypeRender&&(this.scene.renderAzimuth+=t-this.mousePos[0],this.scene.renderElevation+=e-this.mousePos[1],this.mousePos=[t,e],this.drawScene())},l.prototype.sph2cartDeg=function(t,e){var i=-e*(Math.PI/180),s=(t-90)%360*(Math.PI/180),n=[Math.cos(i)*Math.cos(s),Math.cos(i)*Math.sin(s),Math.sin(i)],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return a<=0||(n[0]/=a,n[1]/=a,n[2]/=a),n},l.prototype.clipPlaneUpdate=function(t){if(this.sliceType==this.sliceTypeRender){var e=this.sph2cartDeg(t[0],t[1]);this.scene.clipPlane=[e[0],e[1],e[2],t[2]],this.drawScene()}},l.prototype.setCrosshairColor=function(t){this.opts.crosshairColor=t,this.drawScene()},l.prototype.sliceScroll2D=function(t,e,i){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.mouseClick(e,i,t,s)},l.prototype.setSliceType=function(t){this.sliceType=t,this.drawScene()},l.prototype.setSliceOpacity=function(t){this.sliceOpacity=t,this.drawScene()},l.prototype.setScale=function(t){this.volScaleMultiplier=t,this.drawScene()},l.prototype.attachTo=function(t){return this.gl=document.querySelector(t).getContext("webgl2"),this.gl||alert("unable to get webgl2 context. Perhaps this browser does not support webgl2"),this.init(),this},l.prototype.scaleTo8Bit=function(t,e){var i,s=e.hdr.cal_min,n=e.hdr.cal_max,a=t.length,o=new Uint8ClampedArray(a),r=1;for(n>s&&(r=255/(n-s)),i=0;i<a-1;i++){var l=t[i];l=l*e.hdr.scl_slope+e.hdr.scl_inter,o[i]=(l-s)*r}return o},l.prototype.overlayRGBA=function(t){for(var e=t.hdr,i=e.dims[1]*e.dims[2]*e.dims[3],s=new Uint8ClampedArray(4*i),n=.2*Math.min(Math.min(e.dims[1],e.dims[2]),e.dims[3]),a=.5*e.dims[1],o=.5*e.dims[2],r=.5*e.dims[3],l=0,h=0;h<e.dims[3];h++)for(var c=0;c<e.dims[2];c++)for(var u=0;u<e.dims[1];u++){var d=Math.abs(u-a),p=Math.abs(c-o),g=Math.abs(h-r),m=Math.sqrt(d*d+p*p+g*g),f=0;m<n&&(f=255),s[l]=0,l++,s[l]=f,l++,s[l]=0,l++,s[l]=.5*f,l++}return s},l.prototype.calibrateIntensity=function(t,e){var i,s=t.length,n=1/0,a=-1/0;for(i=0;i<s-1;i++)isFinite(t[i])&&(t[i]<n&&(n=t[i]),t[i]>a&&(a=t[i]));isFinite(e.hdr.scl_slope)&&isFinite(e.hdr.scl_inter)&&0!==e.hdr.scl_slope?(n=n*e.hdr.scl_slope+e.hdr.scl_inter,a=a*e.hdr.scl_slope+e.hdr.scl_inter):(e.hdr.scl_slope=1,e.hdr.scl_inter=0),e.hdr.global_min=n,e.hdr.global_max=a,(!isFinite(e.hdr.cal_min)||!isFinite(e.hdr.cal_max)||e.hdr.cal_min>=e.hdr.cal_max)&&(e.hdr.cal_min=n,e.hdr.cal_max=a)},l.prototype.nii2RAS=function(t){var e=t.volume.hdr,i=e.affine,s=o["a"].fromValues(Math.abs(i[0][0]),Math.abs(i[0][1]),Math.abs(i[0][2]),Math.abs(i[1][0]),Math.abs(i[1][1]),Math.abs(i[1][2]),Math.abs(i[2][0]),Math.abs(i[2][1]),Math.abs(i[2][2])),n=[1,1,1];s[3]>s[0]&&(n[0]=2),s[6]>s[0]&&s[6]>s[3]&&(n[0]=3),n[1]=1,1===n[0]?s[4]>s[7]?n[1]=2:n[1]=3:2===n[0]?s[1]>s[7]?n[1]=1:n[1]=3:s[1]>s[4]?n[1]=1:n[1]=2,n[2]=6-n[1]-n[0];var a=[1,2,3];a[n[0]-1]=1,a[n[1]-1]=2,a[n[2]-1]=3;var r=o["b"].fromValues(i[0][0],i[0][1],i[0][2],i[0][3],i[1][0],i[1][1],i[1][2],i[1][3],i[2][0],i[2][1],i[2][2],i[2][3],0,0,0,1),l=o["b"].create();o["b"].copy(l,r);for(var h=0;h<3;h++)for(var c=0;c<3;c++)l[4*h+c]=r[4*h+a[c]-1];var u=[0,0,0];if(l[0]<0&&(u[0]=1),l[5]<0&&(u[1]=1),l[10]<0&&(u[2]=1),t.dimsRAS=[e.dims[0],e.dims[a[0]],e.dims[a[1]],e.dims[a[2]]],t.pixDimsRAS=[e.pixDims[0],e.pixDims[a[0]],e.pixDims[a[1]],e.pixDims[a[2]]],this.arrayEquals(a,[1,2,3])&&this.arrayEquals(u,[0,0,0]))return t.toRAS=o["b"].create(),void(t.matRAS=o["b"].clone(r));o["b"].identity(r),r[0]=1-2*u[0],r[5]=1-2*u[1],r[10]=1-2*u[2],r[3]=(e.dims[a[0]]-1)*u[0],r[7]=(e.dims[a[1]]-1)*u[1],r[11]=(e.dims[a[2]]-1)*u[2];var d=o["b"].create();o["b"].invert(d,r),o["b"].multiply(d,d,l),t.matRAS=o["b"].clone(d),r=o["b"].fromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),r[a[0]-1+0]=2*-u[0]+1,r[a[1]-1+4]=2*-u[1]+1,r[a[2]-1+8]=2*-u[2]+1,r[3]=u[0],r[7]=u[1],r[11]=u[2],t.toRAS=o["b"].clone(r)},l.prototype.loadVolumes=function(t){var e=this;this.volumes=t,this.back=this.volumes[0],this.overlays=this.volumes.slice(1);for(var i=[],s=null,a=null,o=function(o){console.log("loading ",t[o].url);var r=e.volumes[o].url;i.push(new XMLHttpRequest),i[o].open("GET",r,!0),i[o].responseType="arraybuffer",i[o].onerror=function(){console.error("error loading volume ",this.volumes[o].url)},i[o].onload=function(){var t=i[o].response;s=null,a=null,t?(s=n["readHeader"](t),a=n["isCompressed"](t)?n["readImage"](s,n["decompress"](t)):n["readImage"](s,t)):(alert("Unable to load buffer properly from volume?"),console.log("no buffer?")),this.volumes[o].volume={},this.volumes[o].volume.hdr=s,this.volumes[o].volume.img=a,this.nii2RAS(this.volumes[o]),this.selectColormap(this.volumes[0].colorMap),this.updateGLVolume(this.volumes[0])}.bind(e),i[o].send()},r=0;r<t.length;r++)o(r);return this},l.prototype.rgbaTex=function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t&&this.gl.deleteTexture(t),t=this.gl.createTexture(),this.gl.activeTexture(e),this.gl.bindTexture(this.gl.TEXTURE_3D,t),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_R,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texStorage3D(this.gl.TEXTURE_3D,1,this.gl.RGBA8,i[1],i[2],i[3]),s){var n=new Uint8Array(i[1]*i[2]*i[3]*4);this.gl.texSubImage3D(this.gl.TEXTURE_3D,0,0,0,0,i[1],i[2],i[3],this.gl.RGBA,this.gl.UNSIGNED_BYTE,n)}return t},l.prototype.loadPng=function(t){var e=null;e=new Image,e.onload=function(){var t=this.gl.createTexture();this.gl.activeTexture(this.gl.TEXTURE3),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)}.bind(this),e.src=t},l.prototype.initText=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,i,n,a,o,r,l,h,c,u,d,p,g;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=function(){return a=Object(s["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch("./fnt.json");case 2:return e=t.sent,t.next=5,e.json();case 5:i=t.sent;case 6:case"end":return t.stop()}}),t)}))),a.apply(this,arguments)},n=function(){return a.apply(this,arguments)},t.next=4,this.loadPng("fnt.png");case 4:for(this.fontMets=[],e=0;e<256;e++)this.fontMets[e]={},this.fontMets[e].xadv=0,this.fontMets[e].uv_lbwh=[0,0,0,0],this.fontMets[e].lbwh=[0,0,0,0];return i=[],t.next=9,n();case 9:this.fontMets.distanceRange=i.atlas.distanceRange,this.fontMets.size=i.atlas.size,o=i.atlas.width,r=i.atlas.height,l=0;case 14:if(!(l<i.glyphs.length)){t.next=33;break}if(h=i.glyphs[l],c=h.unicode,this.fontMets[c].xadv=h.advance,void 0!==h.planeBounds){t.next=20;break}return t.abrupt("continue",30);case 20:u=h.atlasBounds.left/o,d=(r-h.atlasBounds.top)/r,p=(h.atlasBounds.right-h.atlasBounds.left)/o,g=(h.atlasBounds.top-h.atlasBounds.bottom)/r,this.fontMets[c].uv_lbwh=[u,d,p,g],u=h.planeBounds.left,d=h.planeBounds.bottom,p=h.planeBounds.right-h.planeBounds.left,g=h.planeBounds.top-h.planeBounds.bottom,this.fontMets[c].lbwh=[u,d,p,g];case 30:l++,t.next=14;break;case 33:case"end":return t.stop()}}),t,this)}))),l.prototype.init=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.FRONT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.rgbaTex(this.volumeTexture,this.gl.TEXTURE0,[2,2,2,2],!0),this.rgbaTex(this.overlayTexture,this.gl.TEXTURE2,[2,2,2,2],!0),e=[0,1,0,1,1,0,0,1,1,1,1,1,1,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,1,1,0,0,1,1,0,1,0,0,0,1,0,0],i=this.gl.createVertexArray(),this.gl.bindVertexArray(i),s=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(0,3,this.gl.FLOAT,!1,0,0),this.sliceShader=new a["a"](this.gl,r["o"],r["i"]),this.sliceShader.use(this.gl),this.gl.uniform1i(this.sliceShader.uniforms["volume"],0),this.gl.uniform1i(this.sliceShader.uniforms["colormap"],1),this.gl.uniform1i(this.sliceShader.uniforms["overlay"],2),this.lineShader=new a["a"](this.gl,r["l"],r["c"]),this.renderShader=new a["a"](this.gl,r["n"],r["h"]),this.renderShader.use(this.gl),this.gl.uniform1i(this.renderShader.uniforms["volume"],0),this.gl.uniform1i(this.renderShader.uniforms["colormap"],1),this.gl.uniform1i(this.renderShader.uniforms["overlay"],2),this.colorbarShader=new a["a"](this.gl,r["j"],r["a"]),this.colorbarShader.use(this.gl),this.gl.uniform1i(this.colorbarShader.uniforms["colormap"],1),this.fontShader=new a["a"](this.gl,r["k"],r["b"]),this.fontShader.use(this.gl),this.gl.uniform1i(this.fontShader.uniforms["fontTexture"],3),this.orientShaderU=new a["a"](this.gl,r["m"],r["g"].concat(r["d"])),this.orientShaderI=new a["a"](this.gl,r["m"],r["f"].concat(r["d"])),this.orientShaderF=new a["a"](this.gl,r["m"],r["e"].concat(r["d"])),t.next=36,this.initText();case 36:return t.abrupt("return",this);case 37:case"end":return t.stop()}}),t,this)}))),l.prototype.updateGLVolume=function(t){console.log(t);for(var e=!0,i=0;i<this.volumes.length;i++)0===i||(e=!1),this.volumes[i].toRAS&&this.refreshLayers(this.volumes[i],e);this.drawScene()},l.prototype.calMinMax=function(t,e){if(0===t.volume.hdr.cal_min||0===t.volume.hdr.cal_max){for(var i=0,s=0,n=0;n<e.length;n++)i=Math.min(e[n],i),s=Math.max(e[n],s);var a=.02*s,o=.98*s;t.volume.hdr.cal_min=a,t.volume.hdr.cal_max=o}else console.log("not setting the calmin and max")},l.prototype.refreshLayers=function(t){var e,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=t.volume.hdr,n=t.volume.img,a=[],o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];i?(this.back={},o=t.toRAS,this.back.matRAS=t.matRAS,this.back.dims=t.dimsRAS,this.back.pixDims=t.pixDimsRAS,a=this.rgbaTex(this.volumeTexture,this.gl.TEXTURE0,t.dimsRAS)):(this.back={},o=t.toRAS,this.back.matRAS=t.matRAS,this.back.dims=t.dimsRAS,this.back.pixDims=t.pixDimsRAS,a=this.rgbaTex(this.overlayTexture,this.gl.TEXTURE2,this.back.dims));var r=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,r),this.gl.disable(this.gl.CULL_FACE),this.gl.viewport(0,0,this.back.dims[1],this.back.dims[2]),this.gl.disable(this.gl.BLEND);var l=this.gl.createTexture();this.gl.activeTexture(this.gl.TEXTURE6),this.gl.bindTexture(this.gl.TEXTURE_3D,l),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_R,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1);var h=this.orientShaderU;if(2===s.datatypeCode)e=new Uint8Array(n),this.gl.texStorage3D(this.gl.TEXTURE_3D,6,this.gl.R8UI,s.dims[1],s.dims[2],s.dims[3]),this.gl.texSubImage3D(this.gl.TEXTURE_3D,0,0,0,0,s.dims[1],s.dims[2],s.dims[3],this.gl.RED_INTEGER,this.gl.UNSIGNED_BYTE,e);else if(4===s.datatypeCode)e=new Int16Array(n),this.gl.texStorage3D(this.gl.TEXTURE_3D,6,this.gl.R16I,s.dims[1],s.dims[2],s.dims[3]),this.gl.texSubImage3D(this.gl.TEXTURE_3D,0,0,0,0,s.dims[1],s.dims[2],s.dims[3],this.gl.RED_INTEGER,this.gl.SHORT,e),h=this.orientShaderI;else if(16===s.datatypeCode)e=new Float32Array(n),this.gl.texStorage3D(this.gl.TEXTURE_3D,6,this.gl.R32F,s.dims[1],s.dims[2],s.dims[3]),this.gl.texSubImage3D(this.gl.TEXTURE_3D,0,0,0,0,s.dims[1],s.dims[2],s.dims[3],this.gl.RED,this.gl.FLOAT,e),h=this.orientShaderF;else if(64===s.datatypeCode){e=new Float64Array(n);var c=new Float32Array;c=Float32Array.from(e),this.gl.texStorage3D(this.gl.TEXTURE_3D,6,this.gl.R32F,s.dims[1],s.dims[2],s.dims[3]),this.gl.texSubImage3D(this.gl.TEXTURE_3D,0,0,0,0,s.dims[1],s.dims[2],s.dims[3],this.gl.RED,this.gl.FLOAT,c),h=this.orientShaderF}else 512===s.datatypeCode&&(e=new Uint16Array(n),this.gl.texStorage3D(this.gl.TEXTURE_3D,6,this.gl.R16UI,s.dims[1],s.dims[2],s.dims[3]),this.gl.texSubImage3D(this.gl.TEXTURE_3D,0,0,0,0,s.dims[1],s.dims[2],s.dims[3],this.gl.RED_INTEGER,this.gl.UNSIGNED_SHORT,e));this.calMinMax(t,e),h.use(this.gl),this.selectColormap(t.colorMap),this.gl.uniform1f(h.uniforms["cal_min"],s.cal_min),this.gl.uniform1f(h.uniforms["cal_max"],s.cal_max),i||(o=[-1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1],this.selectColormap(t.colorMap),this.gl.uniform1f(h.uniforms["cal_min"],s.cal_min),this.gl.uniform1f(h.uniforms["cal_max"],s.cal_max)),this.gl.bindTexture(this.gl.TEXTURE_3D,l),this.gl.uniform1i(h.uniforms["intensityVol"],6),this.gl.uniform1i(h.uniforms["colormap"],1),this.gl.uniform1f(h.uniforms["scl_inter"],s.scl_inter),this.gl.uniform1f(h.uniforms["scl_slope"],s.scl_slope),this.gl.uniformMatrix4fv(h.uniforms["mtx"],!1,o);for(var u=0;u<this.back.dims[3];u++){var d=1/this.back.dims[3]*(u+.5);this.gl.uniform1f(h.uniforms["coordZ"],d),this.gl.framebufferTextureLayer(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,a,0,u),this.gl.clear(this.gl.DEPTH_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,5,4)}this.gl.deleteTexture(l),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.deleteFramebuffer(r)},l.prototype.selectColormap=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.makeLut([0,255],[0,255],[0,255],[0,128],[0,255]);return"Winter"===t&&(e=this.makeLut([0,0,0],[0,128,255],[255,196,128],[0,64,128],[0,128,255])),"Warm"===t&&(e=this.makeLut([255,255,255],[127,196,254],[0,0,0],[0,64,128],[0,128,255])),"Plasma"===t&&(e=this.makeLut([13,156,237,240],[8,23,121,249],[135,158,83,33],[0,56,80,88],[0,64,192,255])),"Viridis"===t&&(e=this.makeLut([68,49,53,253],[1,104,183,231],[84,142,121,37],[0,56,80,88],[0,65,192,255])),"Inferno"===t&&(e=this.makeLut([0,120,237,240],[0,28,105,249],[4,109,37,33],[0,56,80,88],[0,64,192,255])),null!==this.colormapTexture&&this.gl.deleteTexture(this.colormapTexture),this.colormapTexture=this.gl.createTexture(),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colormapTexture),this.gl.texStorage2D(this.gl.TEXTURE_2D,1,this.gl.RGBA8,256,1),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_R,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,256,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this},l.prototype.makeLut=function(t,e,i,s,n){for(var a=new Uint8ClampedArray(1024),o=0;o<n.length-1;o++)for(var r=n[o],l=n[o+1],h=l-r,c=4*r,u=r;u<=l;u++){var d=(u-r)/h;a[c++]=t[o]+d*(t[o+1]-t[o]),a[c++]=e[o]+d*(e[o+1]-e[o]),a[c++]=i[o]+d*(i[o+1]-i[o]),a[c++]=s[o]+d*(s[o+1]-s[o])}return a},l.prototype.sliceScale=function(){var t=[1,this.back.dims[1]*this.back.pixDims[1],this.back.dims[2]*this.back.pixDims[2],this.back.dims[3]*this.back.pixDims[3]],e=Math.max(t[1],Math.max(t[2],t[3])),i=[t[1]/e,t[2]/e,t[3]/e];i=i.map(function(t){return t*this.volScaleMultiplier}.bind(this));var s=[this.back.dims[1],this.back.dims[2],this.back.dims[3]];return{volScale:i,vox:s}},l.prototype.mouseClick=function(t,e){var i,s,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.sliceType!==this.sliceTypeRender&&!(this.numScreenSlices<1||this.gl.canvas.height<1||this.gl.canvas.width<1))for(var o=0;o<this.numScreenSlices;o++){var r=this.screenSlices[o].axCorSag;if(!(r>this.sliceTypeSagittal)){var l=this.screenSlices[o].leftTopWidthHeight,h=!1;l[2]<0&&(h=!0,l[0]+=l[2],l[2]=-l[2]);var c=(t-l[0])/l[2];h&&(c=1-c);var u=1-(e-l[1])/l[3];if(c>=0&&c<1&&u>=0&&u<1)return a?0!==n?(i=this.scene.crosshairPos[2-r],s=i+n,s>1&&(s=1),s<0&&(s=0),this.scene.crosshairPos[2-r]=s,void this.drawScene()):(r===this.sliceTypeAxial&&(this.scene.crosshairPos[0]=c,this.scene.crosshairPos[1]=u),r===this.sliceTypeCoronal&&(this.scene.crosshairPos[0]=c,this.scene.crosshairPos[2]=u),r===this.sliceTypeSagittal&&(this.scene.crosshairPos[1]=c,this.scene.crosshairPos[2]=u),void this.drawScene()):(this.scene.crosshairPos[2-r]=n,void this.drawScene());if(null===t&&null===e)return this.scene.crosshairPos[2-r]=n,void this.drawScene()}}},l.prototype.drawColorbar=function(t){if(!(t[2]<=0||t[3]<=0)){if(this.opts.crosshairWidth>0){this.lineShader.use(this.gl),this.gl.uniform4fv(this.lineShader.uniforms["lineColor"],this.opts.crosshairColor),this.gl.uniform2fv(this.lineShader.uniforms["canvasWidthHeight"],[this.gl.canvas.width,this.gl.canvas.height]);var e=[t[0]-1,t[1]-1,t[2]+2,t[3]+2];this.gl.uniform4f(this.lineShader.uniforms["leftTopWidthHeight"],e[0],e[1],e[2],e[3]),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,5,4)}this.colorbarShader.use(this.gl),this.gl.uniform2fv(this.colorbarShader.uniforms["canvasWidthHeight"],[this.gl.canvas.width,this.gl.canvas.height]),this.gl.uniform4f(this.colorbarShader.uniforms["leftTopWidthHeight"],t[0],t[1],t[2],t[3]),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,5,4)}},l.prototype.textWidth=function(e,i){for(var s=0,n=new t(i),a=0;a<i.length;a++)s+=e*this.fontMets[n[a]].xadv;return s},l.prototype.drawChar=function(t,e,i){var s=this.fontMets[i],n=t[0]+e*s.lbwh[0],a=-e*s.lbwh[1],o=e*s.lbwh[2],r=e*s.lbwh[3],l=t[1]+(a-r)+e;return this.gl.uniform4f(this.fontShader.uniforms["leftTopWidthHeight"],n,l,o,r),this.gl.uniform4fv(this.fontShader.uniforms["uvLeftTopWidthHeight"],s.uv_lbwh),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,5,4),e*s.xadv},l.prototype.drawText=function(e,i){if(!(this.opts.textHeight<=0)){this.fontShader.use(this.gl);var s=this.opts.textHeight*this.gl.canvas.height;this.gl.enable(this.gl.BLEND),this.gl.uniform2f(this.fontShader.uniforms["canvasWidthHeight"],this.gl.canvas.width,this.gl.canvas.height),this.gl.uniform4fv(this.fontShader.uniforms["fontColor"],this.opts.crosshairColor);var n=s/this.fontMets.size*this.fontMets.distanceRange;n=Math.max(n,1),this.gl.uniform1f(this.fontShader.uniforms["screenPxRange"],n);for(var a=new t(i),o=0;o<i.length;o++)e[0]+=this.drawChar(e,s,a[o])}},l.prototype.drawTextRight=function(t,e){this.opts.textHeight<=0||(this.fontShader.use(this.gl),t[1]-=.5*this.opts.textHeight*this.gl.canvas.height,this.drawText(t,e))},l.prototype.drawTextBelow=function(t,e){if(!(this.opts.textHeight<=0)){this.fontShader.use(this.gl);var i=this.opts.textHeight*this.gl.canvas.height;t[0]-=.5*this.textWidth(i,e),this.drawText(t,e)}},l.prototype.draw2D=function(t,e){var i=[this.scene.crosshairPos[0],this.scene.crosshairPos[1],this.scene.crosshairPos[2]];e===this.sliceTypeCoronal&&(i=[this.scene.crosshairPos[0],this.scene.crosshairPos[2],this.scene.crosshairPos[1]]),e===this.sliceTypeSagittal&&(i=[this.scene.crosshairPos[1],this.scene.crosshairPos[2],this.scene.crosshairPos[0]]);var s=this.isRadiologicalConvention&&e<this.sliceTypeSagittal;if(this.sliceShader.use(this.gl),this.gl.uniform1f(this.sliceShader.uniforms["opacity"],this.sliceOpacity),this.gl.uniform1i(this.sliceShader.uniforms["axCorSag"],e),this.gl.uniform1f(this.sliceShader.uniforms["slice"],i[2]),this.gl.uniform2fv(this.sliceShader.uniforms["canvasWidthHeight"],[this.gl.canvas.width,this.gl.canvas.height]),s&&(this.gl.disable(this.gl.CULL_FACE),t[2]=-t[2],t[0]=t[0]-t[2]),this.gl.uniform4f(this.sliceShader.uniforms["leftTopWidthHeight"],t[0],t[1],t[2],t[3]),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,5,4),this.screenSlices[this.numScreenSlices].leftTopWidthHeight=t,this.screenSlices[this.numScreenSlices].axCorSag=e,this.numScreenSlices+=1,!(this.opts.crosshairWidth<=0)){this.lineShader.use(this.gl),this.gl.uniform4fv(this.lineShader.uniforms["lineColor"],this.opts.crosshairColor),this.gl.uniform2fv(this.lineShader.uniforms["canvasWidthHeight"],[this.gl.canvas.width,this.gl.canvas.height]);var n=t[0]+t[2]*i[0];this.gl.uniform4f(this.lineShader.uniforms["leftTopWidthHeight"],n-.5*this.opts.crosshairWidth,t[1],this.opts.crosshairWidth,t[3]),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,5,4);var a=t[1]+t[3]*(1-i[1]);this.gl.uniform4f(this.lineShader.uniforms["leftTopWidthHeight"],t[0],a-.5*this.opts.crosshairWidth,t[2],this.opts.crosshairWidth),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,5,4),this.gl.enable(this.gl.CULL_FACE),s?this.drawTextRight([t[0]+t[2]+1,t[1]+.5*t[3]],"R"):e<this.sliceTypeSagittal&&this.drawTextRight([t[0]+1,t[1]+.5*t[3]],"L"),e===this.sliceTypeAxial&&this.drawTextBelow([t[0]+.5*t[2],t[1]+1],"A"),e>this.sliceTypeAxial&&this.drawTextBelow([t[0]+.5*t[2],t[1]+1],"S")}},l.prototype.draw3D=function(){var t=this.sliceScale(),e=t.volScale,i=t.vox;this.renderShader.use(this.gl),this.gl.canvas.width<this.gl.canvas.height?this.gl.viewport(0,.5*(this.gl.canvas.height-this.gl.canvas.width),this.gl.canvas.width,this.gl.canvas.width):this.gl.viewport(.5*(this.gl.canvas.width-this.gl.canvas.height),0,this.gl.canvas.height,this.gl.canvas.height),this.gl.clearColor(.2,0,0,1);var s=o["b"].create(),n=-.54;o["b"].translate(s,s,[0,0,n]);var a=(90-this.scene.renderElevation-e[0])*Math.PI/180;o["b"].rotate(s,s,a,[-1,0,0]),a=this.scene.renderAzimuth*Math.PI/180,o["b"].rotate(s,s,a,[0,0,1]),o["b"].scale(s,s,e);var r=o["b"].create();o["b"].invert(r,s);var l=o["d"].fromValues(0,0,-1,1);o["d"].transformMat4(l,l,r);var h=o["c"].fromValues(l[0],l[1],l[2]);o["c"].normalize(h,h);var c=1e-5;Math.abs(h[0])<c&&(h[0]=c),Math.abs(h[1])<c&&(h[1]=c),Math.abs(h[2])<c&&(h[2]=c),this.gl.uniformMatrix4fv(this.renderShader.uniforms["mvpMtx"],!1,s),this.gl.uniform1f(this.renderShader.uniforms["overlays"],this.overlays),this.gl.uniform4fv(this.renderShader.uniforms["clipPlane"],this.scene.clipPlane),this.gl.uniform3fv(this.renderShader.uniforms["rayDir"],h),this.gl.uniform3fv(this.renderShader.uniforms["texVox"],i),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,14);var u="azimuth: "+this.scene.renderAzimuth.toFixed(0)+" elevation: "+this.scene.renderElevation.toFixed(0);return u},l.prototype.mm2frac=function(t){var e=o["d"].fromValues(t[0],t[1],t[2],1),i=this.back.dims,s=[0,0,0];if(i[1]<1||i[2]<1||i[3]<1)return s;var n=o["b"].clone(this.back.matRAS);return o["b"].transpose(n,n),o["b"].invert(n,n),o["d"].transformMat4(e,e,n),s[0]=(e[0]+.5)/i[1],s[1]=(e[1]+.5)/i[2],s[2]=(e[2]+.5)/i[3],s},l.prototype.frac2mm=function(t){var e=o["d"].fromValues(t[0],t[1],t[2],1),i=o["d"].fromValues(this.back.dims[1],this.back.dims[2],this.back.dims[3],1),s=o["b"].clone(this.back.matRAS);o["b"].transpose(s,s),o["d"].mul(e,e,i);var n=o["d"].fromValues(-.5,-.5,-.5,0);return o["d"].add(e,e,n),o["d"].transformMat4(e,e,s),this.mm2frac(e),e},l.prototype.scaleSlice=function(t,e){var i=this.gl.canvas.clientWidth/t;e*i>this.gl.canvas.clientHeight&&(i=this.gl.canvas.clientHeight/e);var s=t*i,n=e*i,a=[.5*(this.gl.canvas.clientWidth-s),.5*(this.gl.canvas.clientHeight-n),s,n];return a},l.prototype.drawScene=function(){if(this.gl.clearColor(this.opts.backColor[0],this.opts.backColor[1],this.opts.backColor[2],this.opts.backColor[3]),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.sliceType===this.sliceTypeRender)return this.draw3D();var t=this.sliceScale(),e=t.volScale;if(this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.numScreenSlices=0,this.sliceType===this.sliceTypeAxial){var i=this.scaleSlice(e[0],e[1]);this.draw2D(i,0)}else if(this.sliceType===this.sliceTypeCoronal){var s=this.scaleSlice(e[0],e[2]);this.draw2D(s,1)}else if(this.sliceType===this.sliceTypeSagittal){var n=this.scaleSlice(e[1],e[2]);this.draw2D(n,2)}else{var a=this.scaleSlice(e[0]+e[1],e[1]+e[2]),o=a[2]*e[0]/(e[0]+e[1]),r=this.scaleSlice(e[0]+e[0]+e[1],Math.max(e[1],e[2])),l=r[2]*e[0]/(e[0]+e[0]+e[1]);if(l>o){var h=l/e[0],c=e[1]*h,u=e[2]*h;this.draw2D([r[0],r[1],l,c],0),this.draw2D([r[0]+l,r[1],l,u],1),this.draw2D([r[0]+l+l,r[1],c,u],2)}else{var d=a[2]-o,p=a[3]*e[1]/(e[1]+e[2]),g=a[3]-p;this.draw2D([a[0],a[1]+g,o,p],0),this.draw2D([a[0],a[1],o,g],1),this.draw2D([a[0]+o,a[1],d,g],2);var m=this.opts.colorBarMargin*p;this.drawColorbar([a[0]+o+m,a[1]+g+m,d-m-m,p*this.opts.colorbarHeight])}}this.gl.finish();var f=this.frac2mm([this.scene.crosshairPos[0],this.scene.crosshairPos[1],this.scene.crosshairPos[2]]),v=f[0].toFixed(2)+""+f[1].toFixed(2)+""+f[2].toFixed(2);return v}}).call(this,i("b639").Buffer)},e45c:function(t,e,i){"use strict";i("757a")}});
//# sourceMappingURL=app.01b74c64.js.map